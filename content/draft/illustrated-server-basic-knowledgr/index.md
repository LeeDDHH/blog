# 図解サーバー ~仕事で使える基礎の知識~

## 1章 ~サーバーは何をしているのか~

### サーバーはサービスを提供する

- **他のコンピューターからの要求に応える**のがサーバーの役目
  - サービスを提供するコンピューター
  - 対象は、ネットワークにつながっているほかのコンピューター（クライアント）
  - サーバーがどんなサービスを提供するかはサーバーごとに異なるので、「サーバー」の前にサービスの名前をつけて区別する
    - メールの送受信サービスを提供するメールサーバー
    - インターネットのウェブ閲覧に関するサービスを提供するwebサーバー
  - 受けたいサービスに応じて別々のサーバーをクライアントが利用する
  - 言葉の響きとして難しく感じるかもしれないが、**サーバーが提供するサービスは身近なもの**
  - サービスに対して、提供するサーバー側の視点に切り替えるのがサーバーを理解する第一歩

### サーバーはネットワークを管理する

- サーバーの主な仕事
  - クライアントにさまざまなサービスを提供する
  - クライアントがネットワークを安全で快適に使用できるように管理する
    - ネットワークがきちんと機能するように設定する
    - ネットワークの使用状況を監視し、記録する
  - ファイル共有などで使用しているハードディスクをバックアップする
  - クライアントの管理
    - ネットワークに参加しているクライアントを管理する
    - クライアントごとに利用できるサービスを管理する

### サーバーはなんのためにあるのか

- クライアント/サーバー型で構築することで得られるメリット
  - リソースを集中管理できる
  - 常時稼働で安定したサービスを提供できる
  - P2P型は構築は楽でも、構築後の運用・管理で苦労することが多い
    - 安定した　サービスを提供する必要がある場合、クライアント/サーバー型のネットワークを選ぶべき
    - 言い換えれば、P2Pでは得られないことがサーバーを設けることで得られる

### インターネット関連のサービス

- Webサービス
- メールサービス
- SMTPサーバー
- POP3サーバー
- FTPサービス
- DNSサービス

### LAN関連のサービス

- ファイル共有サービス
- プリンター共有サービス
- DHCPサービス
  - データのやり取りに必要な情報を自動的にクライアントに提供するサービス
- DNSサービス

### サーバー構築に必要なソフトウェア

- サーバー用のOS
  - Windows系
    - Windows Server
  - UNIX系
    - FreeBSD
    - OpenBSD
    - Linux
    - Solaris
    - AIX
    - HP-UX
    - macOSX Server
- サービスを提供するサーバーソフト
  - Webサーバーソフト
  - メールサーバーソフト
  - など

### サーバーを管理する

- ネットワーク管理者の役割
  - ネットワーク構築
    - ネットワークの設計
    - 必要なハードウェアやソフトウェアの準備
    - ケーブルの敷設
    - サーバーの設定
    - クライアントの設定
    - などなど
  - サービスの導入
    - 提供したいサービスに応じてソフトウェアを用意して設定
  - ネットワークの管理
    - ディレクトリサービスでクライアントを管理
    - ネットワークが正常に機能するように使用状況を監視・記録
    - 不具合の対処
  - ソフトウェアの管理
    - サーバー用のOS、サービスを提供するソフトウェアを管理
    - バージョンアップ
    - 修正プログラム（バッチ）の適用
    - クライアントのソフトウェアの管理
  - バックアップ
    - データの定期的なバックアップ
    - 不具合発生時にバックアップしておいたデータに戻す

## 2章 ~ネットワークの基礎を知っておこう~

### ネットワークに繋がっているとはどういうことか？

- 単にケーブルでコンピューターと機器を接続しても、ネットワークで提供されているサービスを利用できなければ、つながったとは言えない
- サービスを利用できる　＝　サーバーやネットワーク機器とクライアントが問題なくデータをやり取りしている
- ネットワークに繋がっていることは、**他のコンピューターや機器とデータをやり取りできる**こと
- プロトコール
  - ネットワークでやり取りするための決まりごと
  - 同じプロトコールに対応していれば、異なるOS、異なるメーカーのコンピューターや機器でも問題なくデータをやり取りすることができる

### データはパケットでやり取りされる

- データには、データをパケットに分割する際、またデータをやり取りする際に、必要な情報がプロトコルによって付け加えられる
  - ヘッダー（データの先頭につける情報）
  - トレーラー（データの末尾につける情報）
- パケットは総称
  - 他にも、**データグラム**、**セグメント**、**フレーム**などと区別することもある
  - データの単位をPDU（プロトコル・データ・ユニット）と言う

### IPアドレスでコンピューターや機器を特定する

- IPアドレス
  - ネットワークの中の住所のようなもの
  - IPプロトコルがコンピューターや機器を特定するために使う

- **ネットワークアドレス**と**ホストアドレス**
  - ネットワークアドレス（ネットワークを識別する）
  - ホストアドレス（個々のコンピューターや機器を識別する）

- 用途や使用するネットワークの規模に応じて、クラスが分けられる
  - クラスA
    - ネットワークアドレス：8ビット
    - ホストアドレス：24ビット
    - 大規模
    - `10.0.0.0` ~ `10.255.255.255`
  - クラスB
    - ネットワークアドレス：16ビット
    - ホストアドレス：16ビット
    - 中規模
    - `172.16.0.0` ~ `172.31.255.255`
  - クラスC
    - ネットワークアドレス：24ビット
    - ホストアドレス：8ビット
    - 小規模
    - `192.168.0.0` ~ `192.168.255.255`
  - クラスD
    - マルチキャストアドレス
  - クラスE
    - 実験用アドレス

- ネットワークアドレスを表す部分が少ないと、表せるネットワーク数は少ない
  - その分、ホストアドレスを表す部分が大きいので、1つのネットワークに多くのコンピューターや機器を接続できる

- ホストアドレス部分が2進数ですべて1のアドレスは**ブロードキャストアドレス**
  - ネットワークに属するすべてのコンピューターや機器に対して一斉にデータが送れる

- マルチキャストアドレスは、ネットワークの中の特定のグループのコンピューターや機器に対して一斉にデータが送れる

### グローバルIPとプライベートIP

- **プライベートIP**
  - 1つのネットワークの中だけで通用するIPアドレス
  - ネットワーク管理者が自由につけてよいアドレス

- **グローバルIP**
  - インターネットデ使われるIPアドレス
  - ICANNという組織が管理をしている
  - 日本では、JPNICが管理業務をしている
    - 一般的にプロバイダーが申請業務を行い、プロバイダーが取得したグローバルIPを借りることで利用する

- 企業ネットワーク
  - ネットワークの中のコンピューターや機器にはプライベートIPをつけるのが一般的
  - 直接インターネットに接続し、データをやり取りする役目を持つコンピューターや機器（ゲートウェイ）にだけグローバルIPをつける

- 家庭
  - ブロードバンドルーターにグローバルIP
    - PCを直接インターネットに接続している場合は、そのPCにグローバルIPがつく
  - 個々のPCや機器にプライベートIPをつける

### サブネッティングとCIDR

- クラスフル
  - IPアドレスをネットワークアドレスとホストアドレスに分ける方法
  - 1つのネットワークで使えるホストアドレスの数が決まっている
    - たとえば、300台のコンピューターや機器をつないだネットワークを1つ作りたいとする
    - クラスCでは、24ビットのネットワークアドレスを使って、8ビットのホストアドレスを使うので、1つのネットワークで300台のコンピューターや機器をつなげるのができない
    - クラスBでは、16ビットのネットワークアドレスを使って、16ビットのホストアドレスを使うので、300台のコンピューターや機器をつなげると膨大なホストアドレスの無駄が発生する
  - ここで、**サブネッティング**という方法が生まれる
    - IPアドレスの32ビットのうち、先頭からどこまでがネットワークアドレスなのかを表す**サブネットマスク**とIPアドレスを併用することで、ネットワークアドレスとホストアドレスの数を調整する
    - 調整された分で表せるようになったネットワークは**サブネットワーク**
- CIDR
  - クラスの概念をなくした考え方
  - **クラスレス**
  - 全体が32ビットのうち、先頭からどこまでがネットワークアドレスなのかをIPアドレスの後ろに「/」をつけて、表記する
    - **CIDR表記**

### ポート番号

- 1台のコンピューターで同時に複数のサービスを利用できるようにする
- トランスポート層のTCP・UDPプロトコルがつけるヘッダーにポート番号の情報が含まれる
- 設定できるポート番号
  - `0~1023`
    - ウェルノウンポート番号
    - IANAという団体が管理する
  - `1024~49151`
    - 予約済みポート番号
    - IANAという団体が登録を受け付けて管理する
  - `49152~65535`
    - 動的・プライベートポート番号

### MACアドレスとは

- ネットワークインターフェイス層のプロトコルがデータをやり取りする相手と自分自身を識別するために使う**物理アドレス**
- ネットワークインターフェイス層に**Ethernet**を採用している場合、物理アドレスは**MACアドレス**になる
- IPアドレスは最終的にデータをやり取りする相手に届くまで変わらない
  - MACアドレスの情報は、「次に送る」相手に届いたら、そこからさらに「次に送る」相手のMACアドレスに書き換えられる
- インターネット層のIPアドレスからMACアドレスを調べるプロトコル
  - **ARPプロトコル**
- MACアドレスからIPアドレスを調べるプロトコル
  - **RARPプロトコル**

### ルーターの役割

- ゲートウェイとして機能して、データの道筋を選択する
- ルーターは**ゲートウェイ**と**ルーティング**という機能を持っている
- **ゲートウェイ**
  - ほかのネットワークへの出入り口として機能するコンピューターや機器
- **ルーティング**
  - データの道筋（ルート）を選択する機能
  - TCP/IPではIPプロトコルが担当する
- **ルーティングテーブル**
  - ほかのネットワークにデータを送信する際、どのルーターに送るかを決めている情報

### NAT、NAPTの仕組み

- **NAT**
  - プライベートIPとグローバルIPを変換する仕組み
  - プライベートIPを持つコンピューターがインターネットにあるコンピューターとデータをやり取りするとき、**IPパケットに送信側のIPアドレスとして、送信側のコンピューターのプライベートIPが記載される**
  - そこで、**ゲートウェイ**が**IPパケットに記載されているプライベートIPをゲートウェイに付けられたグローバルIPに書き換えて**送る
  - 受信側は、届いたIPパケットのヘッダーを参照しsて送信側アドレス（ゲートウェイのグローバルIP）を宛先としてデータを送る
  - データを受け取ったゲートウェイは、どのプライベートIPと変換したかの記録を参照して、本来の受け取り先のコンピューターにデータを送る
- **NAPT**
  - NATでは、グローバルIPとプライベートIPの組み合わせを**1通りしか作れない**
  - 同時に行いたいデータのやり取り野数だけグローバルIPを用意しなければならない
  - そこで、IPアドレスにポート番号を組み合わせたNAPT（**IPマスカレード**）という仕組みを使って、複数のコンピューターでデータをやり取りできるようになる
- グローバルIPとポート番号を組み合わせるNAPTが一般的に使われる

## 3章 ~さまざまなサーバーの働き~

## 4章 ~社内用Windowsサーバーを構築する~

## 5章 ~インターネットに公開するサーバーを構築する~

## 6章 ~サーバーの管理と運用~

## 7章 ~セキュリティ管理~
