# 図解　ネットワーク　仕事で使える基本の知識［改訂新版］

- これまで気にしていなかったデータの流れを意識すれば、そんなに難しくない
- 複雑に見えても、実は非常に合理的
- ネットワーク、サーバーの構築、管理をしていく上で、知っておきたいネットワーク全体の知識を一通りまとめる
- ネットワークには多くのサーバーやネットワーク機器が参加している
  - それぞれが役割を分担してデータを運んでいるので、1つの技術を理解するために、ネットワークの基礎知識を持っていることが大切

## 第1章　ネットワークの基礎知識

- プロトコルの概念と仕組み
- LANとインターネットの違い
- ネットワークの形態
- ネットワークへの接続
- サーバーとは何か

### 1　ネットワークの学習は難しい？

- ネットワークを使う側から**提供する管理者の視点**に切り替える
- データの中身ではなく、**データのやり取りの流れを意識する**
  - 「ネットワークにつながっている」状態は、ネットワークを通じてデータをやり取りできる状態にあること
- 各技術や仕組みは**データのやり取りをするためにある**ことを意識する
  - ネットワークの技術や仕組みは、効率よく相手とデータをやり取りすることを最終目的として考え出されている
  - データをやり取りすることが目的

### 2　プロトコルはフォーマットとプロシージャで構成される

- **プロトコル**
  - ネットワークに参加しているコンピューターや機器がデータのやり取りを行うための決まりごと
  - 同じプロトコルに対応していれば、データのやり取りができる
  - 複数のプロトコルをひとまとめにして、**プロトコル群**とも呼ぶ
- プロトコルの構成
  - **フォーマット**
    - 情報構造
    - **データの構成**に関する決まりごと
    - 必要な情報の表記方法や情報のある場所など、やり取りするデータがどのような構成になっているか
  - **プロシージャ**
    - 通信手順
    - **データをやり取りするときの手順**に関する決まりごと
    - データのやり取りを始めるとき、終了する時、エラーが起きたときなどにどうするのか

### 3　プロトコルはレイヤー構造をとる

- レイヤー構造、階層構造
- レイヤーごとのプロトコルに沿って順場に処理する
- それぞれのレイヤーに役割があり、具体的な作業方法、プロトコルの詳細は異なっても役割は同じ
- あるレイヤーのプロトコルを別のものに変えても、他のレイヤーは影響を受けずそのまま使える

### 4　LANとインターネットの違い

- LAN（Local Area Network）
  - 同じ建物や敷地内にあるネットワーク
  - 企業ネットワーク、家庭内ネットワーク
  - 規模にかかわらず、**ネットワーク全体を管理できる**
  - 外部から許可なく勝手に接続することはできない
  - **閉ざされたネットワーク**
- インターネット
  - 複数のコンピューターが役割を分担して全体が機能する分散型ネットワーク
  - **開かれたネットワーク**
  - インターネットの一部分を管理する企業、団体はいるが、全体を把握する管理者はいない
- LANをインターネットに接続し、**LANの中にコンピューターからインターネットを利用できるようにするのが一般的**
- LANとインターネットの大きな違い
  - **全体を把握できるかどうか**

### 6　サーバーはネットワークサービスを提供する

- サーバー
  - クライアントにネットワークサービスを提供する
  - 提供するネットワークサービスの名前に「サーバー」を付けて呼ぶ
- サーバーの構成
  - **ハードウェア**
  - **サーバー用のOS**
  - **ネットワークサービスを提供するためのソフトウェア**
- **アプライアンス**
  - サーバーとして使用するために設計された専用のハードウェア
- サーバーはコンピューターでなくても、プリンターやネットワーク機器に組み込まれているケースも見られる

### 7　インターネットに接続するには

- 全体を管理していないインターネットに接続するにはどうしたらいいのか
  - 個々のコンピューターや機器を特定するために使われる**グローバルIP**を取得する
  - インターネットを形成する個々のネットワークを識別する**AS番号**も必要
  - 回線設備が必要
  - ケーブルの敷設、通信に必要な装備の設置
  - グローバルIPとドメイン名を対応させるDNSサーバー（降るサービスリゾルバー）
- しかし、小規模のネットワークを使う企業や個人の場合、必要な物を提供する**回線事業者**や**ISP**と契約することになる
- **グローバルIP**
  - インターネットで使われる住所みたいなもの
- **ICANN**
  - グローバルIPとAS番号を管理する組織
  - 各国からICANNの委託をうけて管理する
- **JPNIC**
  - 日本で管理業務をするところ

### 9　FTTHの仕組み

- **FTTH**（Fiber To The Home）
  - 光ファイバーを家庭に敷設し、高速で安定したデータ通信を実現する意味
  - 現在では、企業向けを含めた光ファイバー通信サービスの総称
  - インターネット接続に加え、電話、マルチメディア配信などのサービスも合わせて提供する
  - デジタルの電気信号とデジタルの光信号を相互に変換する
- **ADSL**
  - デジタル電気信号とアナログ電気信号を相互に変換する
- ユーザーのコンピューターから送られたデータは、ユーザー宅から光ファイバーを通じてFTTHサービス事業者の収容局に送る
  - さらに、ISPのネットワークからインターネットへ送られる
- ユーザー宅と収容局を結ぶ光ファイバーのつなげ方で以下のように分ける
  - **PON**（Passive Optical Network）
    - 複数のユーザーで共有する方式
    - コストの負担が少なく、家庭用のFTTHサービスで採用される
  - **SS**（Single Star）
    - ユーザーが専有する方式
    - 企業向け
- FTTHを利用するユーザー宅には、電気信号と光信号を変換する装置を設置する
  - **メディアコンバーター**
    - SS方式で使われる
  - **ONU**（Optical Network Unit）
    - PON方式で使われる
- 収容局にもメディアコンバーターが設置されて、電気信号と光信号を変換する
- 最近では、家庭向けのFTTHサービスも普及しつつある

[光ファイバーが速い理由とその仕組み・構造・材質について楠リカがやさしく解説](https://simpc.jp/rikatech/about-optical-fiber/)

---

## 第2章　TCP/IPを知る

- ネットワーク通信の基本的な仕組み
- ネットワークアーキテクチャーを理解し、ネットワークでどのようにデータが扱われ、流れていくか

### 1　ネットワークアーキテクチャーとOSI参照モデル

- ISO（国際標準化機構）が定めたOSI参照モデル
  - データをやり取りするときに必要な決まりごと（プロトコル）を第1~7層までのレイヤー構造で体系的にまとめる

|層|レイヤー|名前|役割|
|:---:|:---:|:---:|:---:|
|上位層|7層|アプリケーション層|**アプリケーションがどのようにデータを処理するか**の決まりごと|
|上位層|6層|プレゼンテーション層|**データの通信に適した形式やアプリケーションが処理する形式に変換する**ための決まりごと|
|上位層|5層|セッション層|**通信プログラムがデータをやり取りをはじめてから終わるまでの一連の流れ（セッション）**に関する決まりごと<br>データをやり取りする相手との間に仮想的な経路を作り、データのやり取りが終われば通路を閉じる|
|下位層|4層|トランスポート層|**データを確実にやり取りする**ための決まりごと<br>データ圧縮、エラー制御、再送機能など|
|下位層|3層|ネットワーク層|**データをやり取りする道筋（経路選択）**の決まりごと<br>最終的にデータをやり取りする相手との決まりごと|
|下位層|2層|データリンク層|**同じネットワーク内でのデータのやり取り**に関する決まりごと<br>ネットワークに直接つながっている相手との決まりごと|
|下位層|1層|物理層|ケーブルの規格、電気信号の条件などの**物理的/電気的**な決まりごと<br>やり取りされるデータは電気的な信号として扱われる|

### 2　回線交換方式とパケット交換方式

- 回線交換方式
  - 回線を専有して通信を行う
  - 大量のデータをやり取りできる
  - データのやり取りが終わるまで、他のユーザーはその回線を使用できない
- パケット交換方式
  - データをパケット単位に分けて送る
  - 回線の途中でいったん蓄積され、回線が空いているときに送る
  - リアルタイムでの通信には不向き
  - 複数のユーザーが同時に回線を使用できるので効率がいい
- パケット交換方式のデータの流れ
  - 分割したデータの先頭にやり取りに必要な情報（**ヘッダー**）をつけて、パケットを作る
  - 1つのパケットは、**データ本体**と**ヘッダー**がセットになる
  - 末尾にトレーラーをつけることもある
  - 受信側はパケットに付いているヘッダーやトレーラー情報をもとに各レイヤーがパケットを結合してデータに戻す
  - 復元されtあデータは次に処理されるレイヤーに渡され、送信側と逆の順番で処理作業が進む

### 3　ネットワーク標準のプロトコル「TCP/IP」

- **TCP/IP**
  - プロトコルを体系的にまとめ、どのようにネットワークを構成するかという基本概念を表したネットワークアーキテクチャーの1つ
- **TCP/IPプロトコル群**
  - アプリケーション層
  - トランスポート層
  - インターネット層
  - ネットワークインタフェイス層
- TCP/IPネットワークでデータをやり取りするとき
  - ネットワークサービス用のソフトウェアと**TCP/IPプロトコルスタック**がデータを処理する
- プロトコルスタック
  - プロトコルで決めている処理を実際に行うためのプログラム群

### 4　ネットワークインターフェイス層の役割

- **ネットワークインターフェイス層**
  - ケーブルや端子の形状、信号の形式など、物理的な決まりごとを定める
  - OSI参照モデルでの**物理層**と**データリンク層**を担当する
- 実際に処理を行うのは、TCP/IPプロトコルスタックとプロトコルに対応したハードウェア
  - TCP/IPプロトコルスタックは、コンピューターや機器間のデータのやり取りに関する決まりごとの処理を行う
- ネットワークインターフェイス層の代表的なプロトコル
  - **イーサネット（Ethernet）**、**PPP**など
- イーサネット
  - 複数のコンピューターや機器が、1つの回線を効率よく使用できる
  - **規格**
    - 物理的な決まりごとのほう
  - **イーサネットプロトコル**
    - データの処理に関する決まりごと
- PPP
  - コンピューターや機器が1対1の関係で接続されている回線で、データをやり取りするためのプロトコル
  - パスワード認証機能がある
  - 最近はあまり使われてない
  - インターネット接続サービスで正規の会員を認証するときに便利
- PPPoE（PPP over Ethernet）
  - PPPとイーサネットの組み合わせ

### 5　インターネット層の役割

- **インターネット層**
  - 最終的にデータをやり取りする相手との通信に関する決まりごとを定める
  - OSI参照モデルの**ネットワーク層**を担当する
- **IP**
  - トランスポート層のTCP/IPプロトコル群の基盤となるプロトコル
- 最終的にデータをやり取りする相手とデータをやり取りするために必要なこと
  - **どのコンピューターや機器が、最終的にデータをやり取りする相手なのか**を指定する
- **IPアドレス**
  - ネットワークの世界の住所のようなもの
  - ネットワークに参加しているすべてのコンピューわーや機器につけることで、データをやり取りする相手の指定ができる
- **経路選択**、**ルーティング**
  - **どのルートを通って行けばたどり着けるのか**を決める
- IPの主な役割は、IPアドレスの管理と経路選択
- インターネット層のプロトコル
  - IP
  - ARP
    - IPアドレスから対応するMACアドレスを調べる役割
  - RARP
    - MACアドレスから対応するIPアドレスを調べる
  - ICMP
    - IPが担当するデータのやり取りにおいて、エラーが発生した場合に対処するプロトコル
    - pingコマンドで使われる
  - など

### 6　トランスポート層の役割

- **トランスポート層**
  - データのやり取りを制御するプロトコル
  - OSI参照モデルの**トランスポート層**と**セッション層の一部**を担当する
- 通信プログラムがデータのやり取りをはじめてから終了するまでの一連の流れ（セッション）を行う仮想的な通路を作る
  - 仮想的な通路は、**同時に複数作ることができる**ので、**どの仮想的な通路で扱うデータなのかを区別する**必要がある
- **ポート番号**
  - 各通信プログラムに識別子として使う
- TCPには、さらに確実にデータを届けるための機能がある
  - **確認応答**
    - データを受信した側が、送信側にデータを受け取ったと知らせる機能
    - 送信側は、受信側からの知らせを受け取ったら、次のデータを送る
  - **再送**
    - 一定期間待っても確認応答がない場合に、再度同じデータを送る機能
  - **シーケンス番号**
    - どこまでのデータが届いたのかがわかるようにつける番号
- 一般的なデータのやり取りでは、確実に届くTCPを使用する
- 動画配信など、転送速度を重視するネットワークサービスではUDPを使用する

### 7　TCPの通信手順

- TCPを使ったデータのやり取り
  - SYN
    - データをやり取りするリクエストを送るセグメント
  - ACK
    - 応答確認のセグメント
- 3ウェイハンドシェイク
  - 送信側（SYN）
  - 受信側（ACK、SYN）
  - 送信側（ACK）
  - 送信/受信側のそれぞれが、セグメントにつけるシーケンス番号の初期値の情報をやり取りする
- データのやり取り時にセグメントを1つ送るたびにACKを送ると効率が悪い
  - なので、複数のセグメントをまとめてやり取りする
  - ただ、一度に受け取れるデータ量には限度があるので、受信側はACKのヘッダーに**一度に受け取れるデータ量**を記載する
  - 一度に受け取れるデータ量は**ウィンドウサイズ**と呼ぶ
- ACKを受け取った送信側は、送るセグメントがシーケンス番号の何番からはじまるかをヘッダーに記載して送る
  - 受信側は何万まで受け取ったかの用法を記載し、ACKを送る
  - 一定時間待っても受信側からACKが届かなかったら再送する
- セグメントのヘッダーには、送ったセグメントと受け取ったセグメントが同じなのかどうかを検証するための**チェックサム**を含める
  - チェックサムが一致しなかったら、途中で破損したかのうせいがあるので、再送してもらう
- データのやり取りを終了するときは、送信側が**FIN**セグメントを送る
  - 受信側は送信側にACKを返し、その後FINを送る
  - 送信側はACKを送ってデータのやり取りを終了する

### 8　アプリケーション層の役割

- **アプリケーション層**
  - ユーザーにネットワークサービスを提供する
  - ユーザーが作成したデータをアプリケーション層のプロトコルのに沿って整えて、下位のトランスポート層に渡す
  - ユーザーとTCP/IPの橋渡しをしているレイヤー
  - OSI参照モデルの**セッション層**、**プレゼンテーション層**、**アプリケーション層**に相当する
- データのやり取りを行う場合、利用するサービスのプロトコルに対応する必要がある
- **ヘッダー**
  - ユーザーが入力したデータに、受け取る相手のアプリケーション層のプロトコルが正しく処理するのに必要な情報

### 9　TCP/IPネットワークでの各レイヤーの働き

- 上位のレイヤーから渡されたデータはカプセル化される
- TCP/IPの各レイヤーがイーサネットを使ったネットワークでデータをやり取りするときの流れ
  - アプリケーション層
    - 使うサービスのソフトに対応した決まりごとに沿って必要な情報を**ヘッダー**としてつけて、**TCP/IPプロトコルスタック**に渡す
  - トランスポート層
    - トランスポート層のプロトコルに沿って処理をする
    - データを分割して、受信側のTCPが処理を行うときに必要な情報をヘッダーとして付けて、**セグメント**を作る
    - 下位のOSI参照モデルの**トランスポート層**と**セッション層の一部**を担当するの処理に移る
  - インターネット層
    - インターネット層のプロトコル（IP）に沿ってデータを処理する
    - 必要な情報をヘッダーとして付けて、データグラムを作る
    - 下位のネットワークインターフェイス層の処理に移る
  - **カプセル化**
    - 上位の層から受け取ったパケットをひとかたまりのデータとして扱うこと
  - ネットワークインタフェイス層
    - 受け取ったデータグラムをカプセル化し、ネットワークインタフェイス層のプロトコル（イーサネット）に沿って処理する
    - イーサネットの場合、必要な情報をヘッダーとトレーラーとしてつける
    - イーサネットの決まりごとに沿って、データは電気信号になり、ネットワークへと送られる
  - データを受け取った側は、この手順を逆に行う
    - 最終的にデータを受け取るアプリケーションにデータが届く

---

## 第3章　TCP/IPでコンピューターや機器を識別する仕組み

- TCP/IPの各層においてネットワークの危機がどのように識別されているか
- IPアドレス
- ポート番号
- MACアドレス

### 1　TCP/IPの各レイヤーが識別する仕組み

- ネットワークでデータをやり取りするときに、**データをやり取りする相手**を特定する必要がある
  - TCP/IPでは、各レイヤーで相手を特定するために**識別子**という仕組みを使う

|層|識別子|役割|
|:---:|:---:|:---:|
|ネットワークインタフェイス層|MACアドレス|直接データをやり取りするコンピューターや機器を特定する|
|インターネット層|IPアドレス|最終的にデータをやり取りする相手を特定する|
|トランスポート層|ポート番号|アプリケーション層を担当するソフトウェアとの間にある仮想的な通路を識別する|

- 1つのデータをやり取りするときに合計3つの識別子が使われる
- データをやり取りする相手のIPアドレスとポート番号はユーザーがアプリケーション層のソフトウェアを使用して指定する
- MACアドレスは、IPアドレスと対応させるためのプロトコル（**ARP**）を使ってコンピューターや機器が調べるのでユーザーは指定しない

### 2　トランスポート層で使われるポート番号

- **ポート**
  - アプリケーション層を担当するソフトウェアとデータのやり取りを行う仮想的な通路の出入り口
- **ポート番号**
  - データのやり取りのために作られる複数の通路を識別するために使われる
- サーバーからしたら、いつどのクライアントからデータが送られてくるのかがわからない
  - ポートをあらかじめ作っておき、クライアントからのデータを待つ
  - この状態が、**ポートを開放している**という
- クライアント側では、データのやり取りをはじめる際にポートを作成し、ポートにポート番号をつける
  - クライアント側のTCPで、データを分割してセグメントを作成するときにクライアント側のポート番号を送信元にする
  - サーバーソフトのポート番号を宛先としてヘッダーに加える
- セグメントを受け取ったサーバー側のTCPは、ヘッダーにかかれているポート番号を見て、どの通路を使ってデータを渡せばいいかを判断する
  - サーバーから要求されたデータをクライアントに送る
  - この時、クライアント側が送ってきたセグメントのヘッダー情報にあった送信元ポート番号を宛先ポート番号としてヘッダーの情報に加える
- セグメントを受け取ったクライアント側のTCPは、ヘッダー情報にある宛先ポート番号を見て、どの通路にデータを送るのかを判断する

### 3　ポート番号の種類

- **ポート番号**
  - `0 ~ 65535`

|種類|範囲|
|:---:|:---:|
|ウェルノウンポート番号|`0 ~ 1023`|
|予約済みポート番号|`1024 ~ 49151`|
|動的/プライベートポート番号|`49152 ~ 65535`|

- ウェルノウンポート番号
  - 特定の用途に使用するためにIANAが管理する
  - サーバーソフトはウェルノウンポート番号を使うのが一般的
  - |番号|用途|
    |:---:|:---:|
    |20|FTP（データ転送用）|
    |21|FTP（制御用）|
    |22|SSH|
    |23|Telnet|
    |25|SMTP（メール）|
    |53|DNS|
    |67|DHCP|
    |80|HTTP（ウェブ）|
    |110|POP3（メール）|
    |123|NTP|
    |137|NetBIOS名前解決|
    |138|NetBIOS Datagram Service|
    |139|NetBIOS|
    |443|HTTPS|
    |587|Submission（メール送信）|
- 予約済みポート番号
  - サービスやアプリケーションごとに割り当てられたポート番号
  - IANAが登録を受け付ける
- 動的/プライベートポート番号
  - 自由に使えるポート番号
  - クライアントは、この蛮夷のポート番号を使う
  - サーバーソフトのポート番号はサーバーソフトの種類に応じて決められているウェルノウンポート番号を使う

### 4　インターネット層で使われるIPアドレス

- **IPアドレス**
  - インターネット層のIPが**最終的にデータをやり取りするコンピューターや機器を特定するために使う識別子**
  - TCP/IPネットワークに参加しているコンピューターや機器には、IPアドレスが付けられる
  - クライアントには1台につき、1つのIPアドレスをつけるのが一般的
  - サーバーやネットワーク機器の場合、1台に複数のIPアドレスを付けるケースも見られる
- **データグラム**
  - IPが作るパケット
- データグラムのヘッダー
  - 送信元アドレス（自分自身のIPアドレス）と、最終的にデータをやりとりする相手の宛先IPアドレスの情報が含まれる
- **ルーティング**
  - IPは宛先のIPアドレスの情報を参照して、相手にたどり着くまで通る経路
- **割り当てる**
  - ネットワークに参加しているコンピューターや機器にIPアドレスをつけること
- **DHCP**
  - 自動的にIPアドレスを割り当てるネットワーク
  - このサービスがネットワーク内にある場合、ネットワーク管理者が設定作業を行う必要はない
- **IPv4**
  - 32ビットで8桁の2進数を4つ組み合わせたものを10進数にして表す
  - 1つのIPアドレスはネットワークを識別する**ネットワークアドレス**と、個々のコンピューターや機器を識別する**ホストアドレス**に分かれる
    - 同じネットワークに存在するコンピューがーや機器のネットワークアドレス部は同じでホストアドレスはそれぞれ異なる

### 5　IPアドレスのクラス

### 6　グローバルIPとプライベートIP

### 7　サブネットマスクとは

### 8　VLSMとCIDR

### 9　IPアドレスとドメイン名

### 10　ネットワークインターフェイス層で使われるMACアドレス

### 11　ブロードキャストでネットワーク全体に送信

### 12　マルチキャストで特定のグループに送信

### 13　ARPでIPアドレスに該当するMACアドレスを求める

### 14　次世代のIP「IPv6」とは

### コラム　整いつつあるIPv6環境

---

## 第4章　LANで使われている技術

### 1　LANとWAN

### 2　ゲートウェイを設置してほかのネットワークと接続する

### 3　データの道筋を決めるルーティング

### 4　スタティックルーティングとダイナミックルーティング

### 5　ルーティングプロトコルを使ってルーター同士が通信

### 6　LAN内で提供されるネットワークサービス

### 7　DHCPサービスの仕組み

### 8　ディレクトリサービスを導入する

### 9　NATとNAPT

### 10　VPNの仕組み

### 11　無線LANの仕組み

### 12　イーサネットはCSMA/CDでデータの衝突を防ぐ

### コラム　ネットワークの形態を表すネットワークトポロジー

---

## 第5章　ネットワークサービスの仕組み

### 1　ウェブサービスの仕組み

### 2　メールを届けるSMTPサービス

### 3　メールをユーザーが受け取るためのサービス

### 4　SMTPサービスを安全に運用するための技術

### 5　ファイルを転送するFTPサービス

### 6　インターネットを支えるDNSサービス

### 7　クライアントの「代理」になるプロキシサービス

### 8　NTPサービスを利用して正確な時刻を取得

### 9　ウェブページを構成する技術

### 10　ウェブアプリケーションとは

### 11　CMSでサイトを管理

### 12　検索サイトの仕組み

### 13　ネットワークで動画を配信する

### 14　ブログの仕組み

### 15　クラウドコンピューティングとは

### 16　用途に合わせて選ぶクラウドコンピューティングの種類

### コラム　固定電話のIP化

---

## 第6章　ネットワークセキュリティを強固にする

### 1　ネットワークを利用するならセキュリティは必須

### 2　ファイアウォールを構築して不正侵入を防ぐ

### 3　ファイアウォールの種類

### 4　DMZを構築する

### 5　IDSとIPSの仕組み

### 6　ウイルスとは

### 7　ウイルス対策システムを導入する

### 8　コンテンツフィルタリングとは

### 9　ユーザーからの情報漏洩を防ぐ

### 10　社内からの書込は相手に簡単にわかってしまう

### 11　ウェブサービスで使われる暗号化技術「SSL/TLS」

### 12　ネットワークを安全に利用するために

### コラム　暗号化したデータでウェブサイトを利用できるHTTPS

---

## 第7章　ネットワークの構築と管理

### 1　ネットワーク構成を考える

### 2　ネットワーク構成図を描く

### 3　サーバー用のハードウェアとソフトウェアを用意する

### 4　さまざまなネットワーク機器

### 5　ネットワークを小さなネットワークに分割する

### 6　インターネットに接続する

### 7　LANケーブルで機器を接続する

### 8　冗長化とは

### 9　ネットワークを監視して円滑に運用する

### 10　障害の原因を「切り分け」で突き止め対処

### 11　アウトソーシングを活用する
