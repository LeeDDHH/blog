# 本当にやさしく学びたい人の！ 絵解き　ネットワーク超入門

- 昔は、ネットワークの仕組みをある程度知らなければ、ネットワークを使えなかった
- ネットワークを使う側から、作る側になると感じる気持ちのハードルが高くなっている

## 1章　ネットワークって何だろう？

### 1　ネットワークってどんな技術？

#### ネットワークの技術

- ネットワークを使える状態にするための**つなげる技術**
  - データを送るための技術
  - 目的のサイトに正しくアクセスできる
  - データが途中で壊れない
  - 効率よく届く
  - など
- ネットワークでやり取りしたデータを利用するための**活用する技術**
  - 送られたデータを見るための技術
  - 表示方法を工夫する
  - 動画を組み込む
  - 簡単に更新できるようにする
  - ユーザーの投稿を受け付ける
  - など

#### ネットワークは双方向

- ネットワークでは、ユーザーと配信側がコミュニケーションをしながら、双方向にデータをやり取りする
- ユーザー側が制御情報などのデータを送り、配信側はそれを活用してコンテンツをユーザーに届ける

### 2　サーバーとクライアント

- ネットワークを利用してサービスを提供する立場のコンピューターがサーバー
- サービスを受ける立場のコンピューターがクライアント

### 3　プロトコルという共通のルール

- プロトコル
  - 問題なくデータをやり取りするための共通の決まりごと
  - ネットワークに参加しているすべての機器、OS、ネットワークを利用するソフトウェアも同じプロトコルに対応しなければならない
- 標準プロトコル - TCP/IP

### 4　プロトコルのレイヤー構造

#### OSI参照モデル

- |||
  |:---:|:---:|
  |第7層|アプリケーション層|
  |第6層|プレゼンテーション層|
  |第5層|セッション層|
  |第4層|トランスポート層|
  |第3層|ネットワーク層|
  |第2層|データリンク層|
  |第1層|物理層|
- ネットワーク機器の機能を表現するときに使われる
- 「レイヤー◯スイッチ」という危機がある場合、◯の階層のレイヤーから最下位のレイヤー（第1層）まで対応する

#### TCP/IPのレイヤー構造

- |階層名|代表的なプロトコル|
  |:---:|:---:|
  |アプリケーション層|HTTP、FTP、DNS、SMTP、POP3|
  |トランスポート層|TCP、UDP|
  |インターネット層|IP、ICMP、ARP|
  |ネットワークインターフェイス層|イーサネット、PPP、ISDN|

### 5　ネットワークには住所がある

#### ネットワークは特定の相手に届ける

- ネットワークにおいて、サーバーは多くのクライアントとの間で同時にデータをやり取りするが、それぞれのクライアントをすべて把握する
  - 相手を特定してデータをやり取りすることが、ネットワークの大きな特徴

#### ネットワークで相手を特定するには

- 識別子を元に、送り先を特定する

#### 次に持っていくところの住所も必要

- 途中で複数のコンピューターや機器を経由してデータを送る
  - なので、最終的に受け取る識別子とは別に、次に持っていくところの識別子も必要
  - 次にデータを送る宛先は、途中で次々に変わっていく

#### 1つのデータのやり取りには複数の住所が必要

- さらに、ソフトウェアの住所も付けなければならない
  - データ1つに**ソフトウェアの住所**、**コンピューターの住所**、**次に送る住所**
- データのやり取りで行われる作業は、レイヤーとして整理されている
  - 送り主はレイヤーの上位から順に、送り先はレイヤーの下位から順に処理を行う

#### レイヤーごとに必要な住所がある

- トランスポート層
  - ソフトウェア（アプリケーション層）にデータを渡す処理に必要な住所
- インターネット層
  - 送り先のコンピューターや機器にデータを送る処理に必要な住所
- ネットワークインターフェイス層
  - 次に送るコンピューターや機器にデータを送る処理に必要な住所

### 6　インターネットとLAN

#### LANとWANの特徴

- ある範囲で閉じられたネットワーク
  - ネットワーク全体を管理できる
  - 気密情報を安心して扱える
  - 許可なくLANやWANに参加することはできない

#### インターネットの特徴

- 世界中のネットワーク同士をつないで地球規模の巨大なネットワークを作り上げたのがインターネット
- インターネットで使われる規格を決める団体はあるが、インターネット全体を管理している団体や、全体を管理しているサーバーはない

#### インターネットとイントラネット

- イントラネットは、インターネットで使われている技術を使用したLAN
- プロトコルはインターネットと同じTCP/IPを採用している
- LANを使っているにで全体の管理はできる
- LANでTCP/IPを利用することで、インターネットで利用されているサービスに近いサービスを、LANに手軽に導入することができる
- 企業ネットワークの多くはイントラネット

#### LANでインターネットを使えるのはなぜ？

- 企業ネットワークなどのLANに参加しているPCからは、インターネットを利用することができる
  - LANの内部に**インターネットを利用するためのサービスを提供するサーバーや機器**があり、**各PCの代わりにインターネット接続の役割を担っている**から

---

## 2章　データを相手に届けるための技術

### 1　データをやりとりする条件を知ろう

#### 相手にデータを届け、相手からデータを受け取れること

- ケーブルなどで物理的につなぐ技術
- 複数のルートがあった場合に正しいルートを選ぶ技術
- ほかのコンピューターや機器を経由する技術

#### データをやり取りする相手を特定し、届いたかを確認できること

- データをやり取りする相手を特定する技術
- お互いが確認しながらデータをやり取りする技術

#### お互いがデータを正しく理解できること

- お互いがデータを正しく扱う技術
- データをどのように扱えばいいかの情報をつける技術

### 2　パケットとヘッダー

#### パケットにはヘッダーとトレーラーが付けられる

- ヘッダー
  - データ全体を扱う前に知っておきたい情報が入っている
  - 宛先、データの種類、識別番号など、データを適切に処理するための情報
- トレーラー
  - データを全部受け取ったあとに確認するための情報
  - データが正しく送られたかどうかを確認するための情報

#### パケットはレイヤーごとに作られる

- 同じデータをレイヤーの数だけ4回処理することになる
- アプリケーション総出の処理　→　トランスポート層　→　データはパケットに分割され、ヘッダーが付けられる
- トランスポート層で処理されたデータ　→　インターネット層　→　さらに分割され、ヘッダーが付けられる
- インターネット層で処理されたデータ　→　ネットワークインターフェイス層　→　さらに分割してヘッダーとトレーラーをつける　→　ケーブルを通して他のコンピューターや機器へ送られる
- **カプセル化**
  - あるレイヤーで付けられたヘッダーやトレーラーに含まれる制御情報は、他のレイヤーでは**データ本体**なので利用されない

#### セグメント、データグラム、フレーム、パケットの関係

- プロトコルによって、セグメント、データグラム、フレームと呼ぶ
  - データを分割してヘッダーやトレーラーをつけるのは同じ

|名称|プロトコル|
|:---:|:---:|
|セグメント|TCP|
|データグラム|UDP、IP|
|フレーム|イーサネット|

### 3　データ送信の方式

#### ユニキャストは1対1の関係

- **ユニキャスト**
  - **1つの相手にデータを送る**こと
  - 自分たちが利用しているネットワークサービスのほとんどがユニキャストでデータを送り合っている

#### ユニキャスト以外の方式

- **マルチキャスト**
  - 複数の相手にデータを送る
  - データはネットワークの途中にある機器で複製され、マルチキャストアドレスを持つ各コンピューターや機器に送られる
  - ビデオ会議システムやライブ中継などで使われる
  - 送る作業が1回で済むので、負担が軽い
- **ブロードキャスト**
  - ネットワーク全体に送る
  - 1つのネットワークの中にいるすべてのコンピューターや機器に送る
  - DHCPサービスなどで使われる
  - IPv6では廃止される
  - 他のネットワークには送られない
- **エニーキャスト**
  - 「どちらかよい方」に送る
  - 同じサーバーが複数あって、そのうちどれかにデータを送るときに使う
  - DNSサービス出使われるルートサーバーへデータを送るときに使う
- IPアドレス、MACアドレスには「◯◯キャストにするときはこのアドレスを使う」というルールがあるので、決められたアドレスを使うことで送る方式をはっきりさせる

### 4　ネットワークの標準TCP/IP

#### RFC

- IETF（Internet Engineering Task Force）という団体が作成し、公開している
- TCP/IPの決まりごとの採用、見直し、修正などの議論をして、決定したものをRFCとして公開する

#### TCP/IPを実装する

- TCP/IPを実装すること
  - コンピューターや機器に、TCP/IPの決まりごとに従って処理を行う**TCP/IPプロトコルスタック**を組み込むこと
- TCP/IPに対応したハードウェア、TCP/IPプロトコル・スタック、TCP/IPにに対応したソフトウェアを揃えば、TCP/IPを採用したネットワークが利用できる

### 5　TCP/IPの4つのレイヤー

#### アプリケーション層はユーザーに一番近いレイヤー

- 制御情報を追加、データ形式を変換など

#### データのやり取りを制御するトランスポート層

- データをやり取りする相手と届いたかどうかを確認する
- データを利用するソフトウェア（アプリケーション層）への経路を管理

#### 最終目的地までたどり着くためのインターネット層

- 識別子で相手を特定する
- 最終目的地までの道のりを選択する

#### 次の目的地までを担当するネットワークインターフェイス層

- 隣り合ったコンピューターや機器との間のデータのやり取りを管理する
- その他のコンピューターや機器を経由するよう、次の目的地までを担当する

#### 何を担当するかによって使う住所が決まってくる

- トランスポート層
  - アプリケーション層のソフトウェアを区別するために識別子として、ポート番号を使う
- インターネット層
  - 最終的にデータを受け取る相手を特定するために識別子として、IPアドレスを使う
- ネットワークンターフェイス層
  - 直接データをやり取りする相手を特定するために識別子として、MACアドレスを使う

### 6　TCPとUDP

#### ソフトウェアからソフトウェアまでの仮想的な通路をつくる

- ネットワークで、1台のコンピューター出同時に複数のソフトウェアとサーバーを使ってサービスを利用できる
  - トランスポート層がソフトウェアごとに仮想的なデータの通路を作って管理しているから

#### ポート番号で仮想的なデータの通路を識別

- トランスポート層は、複数の仮想的なデータの通路を区別するために、ポート番号を使う
- 送り手のトランスポート層でやっていること
  - 送り手と送り先のポート番号をヘッダーの情報としてデータ本体に追加する
  - それぞれのポート番号を指定することによって、どのソフトウェアとの間でデータをやり取りするかの指定ができる
- どうやって相手のポート番号を知るのか

#### ポート番号の決め方

- トランスポート層では、自分のポート番号を49152~65535の中から1つ選んでヘッダーに追加する
  - 49152~65535は「動的/プライベートポート番号」
- 送り先のポート番号は、利用するサーバーソフトの種類によって決められている
  - よく使われるポート番号は「ウェルノウンポート番号」
  - クライアントはこの範囲のポート番号を使わない

#### サーバーはクライアントが送ってきた動的/プライベートポート番号を宛先にする

- サーバー側で適切な処理をした後、トランスポート層からクライアントにデータを返す際
  - ヘッダー情報にはクライアントのポート番号を宛先のポート番号として追加する
  - 送り主はサーバーソフトのポート番号

#### ポート番号

|番号|種類|用途|
|:---:|:---:|:---:|
|`0~1023`|ウェルノウンポート番号|サーバーソフトが使用する|
|`1024~49151`|予約済みポート番号|特定のネットワークサービス、ソフトウェアに割り当てられている<br>サーバーもクライアントも使用できる|
|`49152~65535`|動的/プライベート番号|自由に使える<br>クライアントが使用する|

#### 確実にデータをやり取りするTCP

- TCPが、確実にデータをやり取りするために持っている仕組み
  - **確認応答**
    - 応答を、ACK（ACKnowledgeの略）
  - **再送**
    - ACKが届かなかった場合、同じデータを再度送る
  - **シーケンス番号**
    - やり取りするデータに番号を付けて確認する

#### 3ウェイハンドシェイク

- トランスポートのプロトコルとしてTCPを使う場合、仮想的なデータの連絡を作る際に、3ウェイハンドシェイク方法をとる
  - 接続を要求するパケットをクライアントからサーバーへ送る（SYN）
  - サーバーで要求に応じられる場合は、応答確認をする（SYN、ACK）
  - クライアントから応答確認を送る（ACK）

### 7　IP

- IP（Internet Protocol）

#### 最終的にデータを受け取る相手との通信を担当

- IPは最終的にデータを受け取る相手とのデータのやり取りに関する決まりごとを定める
- 最終的にデータを受け取る相手を特定するための**IPアドレス**
- 相手のコンピューターまでの道のりを選択する**ルーティング**

#### IPアドレスって何？

- IPアドレスはTCP/IPネットワークに参加しているコンピューターや機器には必ず付けられている

#### IPアドレスの構成

- IPv4において、IPアドレスは32ビットのデータ
  - 2進数が32個並ぶ
  - 8ビットずつ分けて、10進数とする
- IPアドレスの構成要素
  - ネットワークアドレス
    - どのネットワークかを表す
  - ホストアドレス
    - そのネットワークのどのコンピューターや機器かを表す

#### IPアドレスのクラス

- AからEクラス
  - |クラス|ビット（2進数）|ネットワークアドレス（先頭から）|ホストアドレス|IPアドレス範囲|
    |:---:|:---:|:---:|:---:|:---:
    |クラスA|`0xxxxxxx.・・・`|8ビット|24ビット|`0.0.0.0 ~ 127.255.255.255`|
    |クラスB|`10xxxxxx.・・・`|16ビット|16ビット|`128.0.0.0 ~ 191.255.255.255`|
    |クラスC|`110xxxxx.・・・`|24ビット|8ビット|`192.0.0.0 ~ 223.255.255.255`|
    |クラスD|`1110xxxx.・・・`|4ビット|28ビット|`224.0.0.0 ~ 239.255.255.255`|
    |クラスE|`1111xxxx.・・・`|5ビット|27ビット|`240.0.0.0 ~ 255.255.255.255`|
  - [第8回　アドレス・クラスとさまざまなIPアドレス：基礎から学ぶWindowsネットワーク（1/3 ページ） - ＠IT](https://atmarkit.itmedia.co.jp/ait/articles/0301/17/news003.html)
- ネットワークで使うのはA~C
- Dはマルチキャストアドレス
- Eは実験用のアドレス
- ブロードキャストアドレス
  - ホストアドレスのビットがすべて1のIPアドレス

#### ネットワークの構成でクラスを使い分ける

- ネットワークアドレスが多ければ、それだけ表せるネットワークの数が増える
  - しかし、ホストアドレスが減って、つなげられるコンピューターや機器の数が少なくなる
- ネットワークに参加するコンピューターや機器の数に応じて、IPアドレスのクラスを使い分ける
  - ||ネットワークアドレス|ホストアドレス|
    |:---:|:---:|:---:|
    |クラスA|126個|約1600万個|
    |クラスB|約1600万個|約65000個|
    |クラスC|約200万個|254個|
- 同じネットワークに参加しているコンピューターや機器は、同じネットワークアドレスを持っている
  - ネットワークが異なれば、異なるネットワークアドレスが必要

#### サブネットマスクでネットワークを分割

- IPアドレスをクラスで分ける仕組みでは、使わないIPアドレスが出てしまって、効率がよくない
  - サブネットマスクという仕組みが必要になった
- ホストアドレスの一部をサブネットワークを表す部分として使うことで、1つのネットワークアドレスを異なるネットワークで利用できる
  - サブネットの分、ホストアドレスが減るので、表せるホストアドレスが減る

#### クラスレスアドレッシング

- サブネットマスクを使う方法でも、クラスに分けるやり方に変わりなく、効率が良いとは言えない
- クラスに分けること自体をやめる**クラスレスアドレッシング**が登場する
  - 先頭からどこまでがネットワークアドレスかを**CIDR**という表記で表す
  - 任意の単位でアドレスを区切ることができて、IPアドレスを効率的に利用できるようになった
  - `172.16.10.125/24`　→　先頭から24ビットまでネットワークアドレス


#### グローバルIPアドレスとプライベートIPアドレス

- IPアドレスの種類
  - グローバルIPアドレス
    - インターネットで通用するIPアドレス
    - ICANN（日本ではJPNIC）が重複しないように管理している
  - プライベートIPアドレス（ローカルIPアドレス）
    - 1つのネットワークの中だけで有効なIPアドレス
    - 別のネットワークに同じIPアドレスがあることもある
- IPアドレスには「この範囲はプライベートIPアドレスとして使う」という範囲が決められている
- プライベートIPアドレスの範囲
  - |クラス名|範囲|
    |:---:|:---:|
    |クラスA|`10.0.0.0 ~ 10.255.255.255`|
    |クラスB|`172.16.0.0 ~ 172.31.255.255`|
    |クラスC|`192.168.0.0 ~ 192.168.255.255`|

### 8　IPv6

#### グローバルIPアドレスが足りない

- インターネットの普及にともなって、グローバルIPアドレスが足りなくなる問題が発生した
  - そこで、IPバージョン6（IPv6）が策定され、IPアドレスの仕組みが大きく変更される

- IPv4
  - 32ビットのデータ
  - IPアドレスの数は約43億個
- IPv6
  - 128ビットのデータ
  - IPアドレスの数は約43億x約43億x約43億x約43億個
  - 16ビットずつ「：」で区切って16進数で表す

#### IPv4とIPv6を共存させる

- インターネットは1つの企業や団体が管理しているわけではない
  - そのため、ある日を堺にすべてをIPv6へ切り替えることができない
  - 当面はIPv4とIPv6を共存させ、徐々にIPv6に切り替えていくことになる
  - カプセル化などの技術を使うことでIPv4とIPv6を共存させている
  - 一般的に使われているPCやスマホはIPv4とIPv6の両方に対応している

#### IPv6になると必要なくなるもの

- IPv6では、IPアドレスを節約するための仕組みは必要なくなる
- IPv6に機能として盛り込まれたことで必要なくなる仕組みもある
  - NAT、NAPT
  - ARP
  - DHCP

#### いろいろなものにIPアドレスを割り当てて活用する

- IPv6では、IPアドレスの数を気にせず、さまざまなものに割り当てることができる

### 9　ルーティング

- 最終的にデータを受け取る相手にたどり着くために、どのルートを通ればいいのかを選択する

#### ルートを決めるルーティングは、ルーターが担当

- ルーティング（経路選択）
- ほかのネットワークに参加しているコンピューターや機器との間でデータをやり取りするときに使われる
  - データを送りたい相手にたどり着くためにどのルートを選べばいいかを把握する
- ルーターによって管理される

#### ルーティングテーブルでルートを選択

- ルーターは、送るデータに付いているIPアドレスと**ルーティングテーブル**を見て、どのルートを選べばいいかを判断する
- ルーティングテーブル
  - 「該当するネットワークに参加しているコンピューターや機器に送る上で、どのネットワークのルータに送信するか」の指示が書かれている

#### スタティックルーティングとダイナミックルーティング

- スタティックルーティング
  - ネットワーク管理者が手作業でルーティングテーブルを作る方法
  - 作業は面倒
  - 人間が作るからルーターとネットワークの負担が少ない
  - 小規模のネットワークやルートが決まっているネットワークで使われる
- ダイナミックルーティング
  - ルーター同士が「ルーティングプロトコル」を使って情報を交換し、目的地にルーティングテーブルを作る方法
  - 作業が簡単
  - ルーターとネットワークの負担が大きい
  - 大規模のネットワークで使われる
    - 登録する情報が多いし、変更があったら登録し直す手間がかかるから

#### IGPとEGP

- ルーティングプロトコル
  - ルーター同士がルーティングテーブルに必要な情報を交換するときの決まりごと
- IGP
  - AS（自律システム）内で利用される
- EGP
  - AS間で利用される
- AS
  - インターネットのように大規模で全体の管理が難しいネットワークを、プロバイダーや企業などの単位で分けたもの

#### ディスタンスベクター型とリンクステート型

- ディスタンスベクター型
  - 隣のルーターとルーティングテーブルの情報を交換する
  - 距離と方向をもとにルートを決める
- リンクステート型
  - すべてのルーターと接続情報を交換して、その情報を元にルーティングテーブルを作る
  - 接続の状態をもとにルートを決める

### 10　ゲートウェイ

#### 

#### 

#### 

#### 

#### 

#### 

### 11　イーサネットと無線LAN

### 12　ドメイン名とDNSサービス

### 13　DHCPで接続情報を自動設定

---

## 3章　データを活用するための技術

### 1　ネットワークサービスを知ろう

### 2　Webサービスの基本

### 3　Webサイトのしくみ

### 4　SNSのしくみ

### 5　動画配信のしくみ

### 6　ネット検索のしくみ

### 7　メールのしくみ

### 8　クラウドのしくみ

---

## 4章　ネットワークを導入する

### 1　ネットワークの基本は家庭用も企業用も同じ

### 2　ネットワーク構築の準備

### 3　インターネット接続

### 4　ネットワーク機器

### 5　LANケーブル

### 6　小さなネットワークに分けて管理

### 7　LANで使われるネットワークサービス

### 8　インターネットに公開するサーバーを構築する

### 9　LANとLANを結んでWANを作る

### 10　無線LANを導入する

---

## 5章　ネットワークのセキュリティ

### 1　ネットワークのセキュリティを知ろう

### 2　コンピューターウイルス（マルウェア）とは

### 3　許可なくネットワークを利用する不正侵入

### 4　ネットワーク内からの情報漏洩

### 5　ファイアウォールでネットワークを守る

### 6　プロキシの導入

### 7　データを暗号化するSSL/TLS

### 8　無線LANのセキュリティ

### 9　情報セキュリティポリシーを策定する

### 10　企業ネットワークのセキュリティ対策

### 11　ウイルス対策ソフトを導入する
