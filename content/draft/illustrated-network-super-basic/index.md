# 本当にやさしく学びたい人の！ 絵解き　ネットワーク超入門

- 昔は、ネットワークの仕組みをある程度知らなければ、ネットワークを使えなかった
- ネットワークを使う側から、作る側になると感じる気持ちのハードルが高くなっている

## 1 章　ネットワークって何だろう？

### 1 　ネットワークってどんな技術？

#### ネットワークの技術

- ネットワークを使える状態にするための**つなげる技術**
  - データを送るための技術
  - 目的のサイトに正しくアクセスできる
  - データが途中で壊れない
  - 効率よく届く
  - など
- ネットワークでやり取りしたデータを利用するための**活用する技術**
  - 送られたデータを見るための技術
  - 表示方法を工夫する
  - 動画を組み込む
  - 簡単に更新できるようにする
  - ユーザーの投稿を受け付ける
  - など

#### ネットワークは双方向

- ネットワークでは、ユーザーと配信側がコミュニケーションをしながら、双方向にデータをやり取りする
- ユーザー側が制御情報などのデータを送り、配信側はそれを活用してコンテンツをユーザーに届ける

### 2 　サーバーとクライアント

- ネットワークを利用してサービスを提供する立場のコンピューターがサーバー
- サービスを受ける立場のコンピューターがクライアント

### 3 　プロトコルという共通のルール

- プロトコル
  - 問題なくデータをやり取りするための共通の決まりごと
  - ネットワークに参加しているすべての機器、OS、ネットワークを利用するソフトウェアも同じプロトコルに対応しなければならない
- 標準プロトコル - TCP/IP

### 4 　プロトコルのレイヤー構造

#### OSI 参照モデル

- |         |                      |
  | :-----: | :------------------: |
  | 第 7 層 |  アプリケーション層  |
  | 第 6 層 | プレゼンテーション層 |
  | 第 5 層 |     セッション層     |
  | 第 4 層 |   トランスポート層   |
  | 第 3 層 |    ネットワーク層    |
  | 第 2 層 |    データリンク層    |
  | 第 1 層 |        物理層        |
- ネットワーク機器の機能を表現するときに使われる
- 「レイヤー ◯ スイッチ」という危機がある場合、◯ の階層のレイヤーから最下位のレイヤー（第 1 層）まで対応する

#### TCP/IP のレイヤー構造

- |             階層名             |     代表的なプロトコル     |
  | :----------------------------: | :------------------------: |
  |       アプリケーション層       | HTTP、FTP、DNS、SMTP、POP3 |
  |        トランスポート層        |          TCP、UDP          |
  |        インターネット層        |       IP、ICMP、ARP        |
  | ネットワークインターフェイス層 |  イーサネット、PPP、ISDN   |

### 5 　ネットワークには住所がある

#### ネットワークは特定の相手に届ける

- ネットワークにおいて、サーバーは多くのクライアントとの間で同時にデータをやり取りするが、それぞれのクライアントをすべて把握する
  - 相手を特定してデータをやり取りすることが、ネットワークの大きな特徴

#### ネットワークで相手を特定するには

- 識別子を元に、送り先を特定する

#### 次に持っていくところの住所も必要

- 途中で複数のコンピューターや機器を経由してデータを送る
  - なので、最終的に受け取る識別子とは別に、次に持っていくところの識別子も必要
  - 次にデータを送る宛先は、途中で次々に変わっていく

#### 1 つのデータのやり取りには複数の住所が必要

- さらに、ソフトウェアの住所も付けなければならない
  - データ 1 つに**ソフトウェアの住所**、**コンピューターの住所**、**次に送る住所**
- データのやり取りで行われる作業は、レイヤーとして整理されている
  - 送り主はレイヤーの上位から順に、送り先はレイヤーの下位から順に処理を行う

#### レイヤーごとに必要な住所がある

- トランスポート層
  - ソフトウェア（アプリケーション層）にデータを渡す処理に必要な住所
- インターネット層
  - 送り先のコンピューターや機器にデータを送る処理に必要な住所
- ネットワークインターフェイス層
  - 次に送るコンピューターや機器にデータを送る処理に必要な住所

### 6 　インターネットと LAN

#### LAN と WAN の特徴

- ある範囲で閉じられたネットワーク
  - ネットワーク全体を管理できる
  - 機密情報を安心して扱える
  - 許可なく LAN や WAN に参加することはできない

#### インターネットの特徴

- 世界中のネットワーク同士をつないで地球規模の巨大なネットワークを作り上げたのがインターネット
- インターネットで使われる規格を決める団体はあるが、インターネット全体を管理している団体や、全体を管理しているサーバーはない

#### インターネットとイントラネット

- イントラネットは、インターネットで使われている技術を使用した LAN
- プロトコルはインターネットと同じ TCP/IP を採用している
- LAN を使っているにで全体の管理はできる
- LAN で TCP/IP を利用することで、インターネットで利用されているサービスに近いサービスを、LAN に手軽に導入することができる
- 企業ネットワークの多くはイントラネット

#### LAN でインターネットを使えるのはなぜ？

- 企業ネットワークなどの LAN に参加している PC からは、インターネットを利用することができる
  - LAN の内部に**インターネットを利用するためのサービスを提供するサーバーや機器**があり、**各 PC の代わりにインターネット接続の役割を担っている**から

---

## 2 章　データを相手に届けるための技術

### 1 　データをやりとりする条件を知ろう

#### 相手にデータを届け、相手からデータを受け取れること

- ケーブルなどで物理的につなぐ技術
- 複数のルートがあった場合に正しいルートを選ぶ技術
- ほかのコンピューターや機器を経由する技術

#### データをやり取りする相手を特定し、届いたかを確認できること

- データをやり取りする相手を特定する技術
- お互いが確認しながらデータをやり取りする技術

#### お互いがデータを正しく理解できること

- お互いがデータを正しく扱う技術
- データをどのように扱えばいいかの情報をつける技術

### 2 　パケットとヘッダー

#### パケットにはヘッダーとトレーラーが付けられる

- ヘッダー
  - データ全体を扱う前に知っておきたい情報が入っている
  - 宛先、データの種類、識別番号など、データを適切に処理するための情報
- トレーラー
  - データを全部受け取ったあとに確認するための情報
  - データが正しく送られたかどうかを確認するための情報

#### パケットはレイヤーごとに作られる

- 同じデータをレイヤーの数だけ 4 回処理することになる
- アプリケーション総出の処理　 → 　トランスポート層　 → 　データはパケットに分割され、ヘッダーが付けられる
- トランスポート層で処理されたデータ　 → 　インターネット層　 → 　さらに分割され、ヘッダーが付けられる
- インターネット層で処理されたデータ　 → 　ネットワークインターフェイス層　 → 　さらに分割してヘッダーとトレーラーをつける　 → 　ケーブルを通して他のコンピューターや機器へ送られる
- **カプセル化**
  - あるレイヤーで付けられたヘッダーやトレーラーに含まれる制御情報は、他のレイヤーでは**データ本体**なので利用されない

#### セグメント、データグラム、フレーム、パケットの関係

- プロトコルによって、セグメント、データグラム、フレームと呼ぶ
  - データを分割してヘッダーやトレーラーをつけるのは同じ

|     名称     |  プロトコル  |
| :----------: | :----------: |
|  セグメント  |     TCP      |
| データグラム |   UDP、IP    |
|   フレーム   | イーサネット |

### 3 　データ送信の方式

#### ユニキャストは 1 対 1 の関係

- **ユニキャスト**
  - **1 つの相手にデータを送る**こと
  - 自分たちが利用しているネットワークサービスのほとんどがユニキャストでデータを送り合っている

#### ユニキャスト以外の方式

- **マルチキャスト**
  - 複数の相手にデータを送る
  - データはネットワークの途中にある機器で複製され、マルチキャストアドレスを持つ各コンピューターや機器に送られる
  - ビデオ会議システムやライブ中継などで使われる
  - 送る作業が 1 回で済むので、負担が軽い
- **ブロードキャスト**
  - ネットワーク全体に送る
  - 1 つのネットワークの中にいるすべてのコンピューターや機器に送る
  - DHCP サービスなどで使われる
  - IPv6 では廃止される
  - 他のネットワークには送られない
- **エニーキャスト**
  - 「どちらかよい方」に送る
  - 同じサーバーが複数あって、そのうちどれかにデータを送るときに使う
  - DNS サービス出使われるルートサーバーへデータを送るときに使う
- IP アドレス、MAC アドレスには「◯◯ キャストにするときはこのアドレスを使う」というルールがあるので、決められたアドレスを使うことで送る方式をはっきりさせる

### 4 　ネットワークの標準 TCP/IP

#### RFC

- IETF（Internet Engineering Task Force）という団体が作成し、公開している
- TCP/IP の決まりごとの採用、見直し、修正などの議論をして、決定したものを RFC として公開する

#### TCP/IP を実装する

- TCP/IP を実装すること
  - コンピューターや機器に、TCP/IP の決まりごとに従って処理を行う**TCP/IP プロトコルスタック**を組み込むこと
- TCP/IP に対応したハードウェア、TCP/IP プロトコル・スタック、TCP/IP にに対応したソフトウェアを揃えば、TCP/IP を採用したネットワークが利用できる

### 5 　 TCP/IP の 4 つのレイヤー

#### アプリケーション層はユーザーに一番近いレイヤー

- 制御情報を追加、データ形式を変換など

#### データのやり取りを制御するトランスポート層

- データをやり取りする相手と届いたかどうかを確認する
- データを利用するソフトウェア（アプリケーション層）への経路を管理

#### 最終目的地までたどり着くためのインターネット層

- 識別子で相手を特定する
- 最終目的地までの道のりを選択する

#### 次の目的地までを担当するネットワークインターフェイス層

- 隣り合ったコンピューターや機器との間のデータのやり取りを管理する
- その他のコンピューターや機器を経由するよう、次の目的地までを担当する

#### 何を担当するかによって使う住所が決まってくる

- トランスポート層
  - アプリケーション層のソフトウェアを区別するために識別子として、ポート番号を使う
- インターネット層
  - 最終的にデータを受け取る相手を特定するために識別子として、IP アドレスを使う
- ネットワークンターフェイス層
  - 直接データをやり取りする相手を特定するために識別子として、MAC アドレスを使う

### 6 　 TCP と UDP

#### ソフトウェアからソフトウェアまでの仮想的な通路をつくる

- ネットワークで、1 台のコンピューター出同時に複数のソフトウェアとサーバーを使ってサービスを利用できる
  - トランスポート層がソフトウェアごとに仮想的なデータの通路を作って管理しているから

#### ポート番号で仮想的なデータの通路を識別

- トランスポート層は、複数の仮想的なデータの通路を区別するために、ポート番号を使う
- 送り手のトランスポート層でやっていること
  - 送り手と送り先のポート番号をヘッダーの情報としてデータ本体に追加する
  - それぞれのポート番号を指定することによって、どのソフトウェアとの間でデータをやり取りするかの指定ができる
- どうやって相手のポート番号を知るのか

#### ポート番号の決め方

- トランスポート層では、自分のポート番号を 49152~65535 の中から 1 つ選んでヘッダーに追加する
  - 49152~65535 は「動的/プライベートポート番号」
- 送り先のポート番号は、利用するサーバーソフトの種類によって決められている
  - よく使われるポート番号は「ウェルノウンポート番号」
  - クライアントはこの範囲のポート番号を使わない

#### サーバーはクライアントが送ってきた動的/プライベートポート番号を宛先にする

- サーバー側で適切な処理をした後、トランスポート層からクライアントにデータを返す際
  - ヘッダー情報にはクライアントのポート番号を宛先のポート番号として追加する
  - 送り主はサーバーソフトのポート番号

#### ポート番号

|     番号      |          種類          |                                                用途                                                |
| :-----------: | :--------------------: | :------------------------------------------------------------------------------------------------: |
|   `0~1023`    | ウェルノウンポート番号 |                                      サーバーソフトが使用する                                      |
| `1024~49151`  |   予約済みポート番号   | 特定のネットワークサービス、ソフトウェアに割り当てられている<br>サーバーもクライアントも使用できる |
| `49152~65535` | 動的/プライベート番号  |                               自由に使える<br>クライアントが使用する                               |

#### 確実にデータをやり取りする TCP

- TCP が、確実にデータをやり取りするために持っている仕組み
  - **確認応答**
    - 応答を、ACK（ACKnowledge の略）
  - **再送**
    - ACK が届かなかった場合、同じデータを再度送る
  - **シーケンス番号**
    - やり取りするデータに番号を付けて確認する

#### 3 ウェイハンドシェイク

- トランスポートのプロトコルとして TCP を使う場合、仮想的なデータの連絡を作る際に、3 ウェイハンドシェイク方法をとる
  - 接続を要求するパケットをクライアントからサーバーへ送る（SYN）
  - サーバーで要求に応じられる場合は、応答確認をする（SYN、ACK）
  - クライアントから応答確認を送る（ACK）

### 7 　 IP

- IP（Internet Protocol）

#### 最終的にデータを受け取る相手との通信を担当

- IP は最終的にデータを受け取る相手とのデータのやり取りに関する決まりごとを定める
- 最終的にデータを受け取る相手を特定するための**IP アドレス**
- 相手のコンピューターまでの道のりを選択する**ルーティング**

#### IP アドレスって何？

- IP アドレスは TCP/IP ネットワークに参加しているコンピューターや機器には必ず付けられている

#### IP アドレスの構成

- IPv4 において、IP アドレスは 32 ビットのデータ
  - 2 進数が 32 個並ぶ
  - 8 ビットずつ分けて、10 進数とする
- IP アドレスの構成要素
  - ネットワークアドレス
    - どのネットワークかを表す
  - ホストアドレス
    - そのネットワークのどのコンピューターや機器かを表す

#### IP アドレスのクラス

- A から E クラス
  - |  クラス  | ビット（2 進数）  | ネットワークアドレス（先頭から） | ホストアドレス |        IP アドレス範囲        |
    | :------: | :---------------: | :------------------------------: | :------------: | :---------------------------: |
    | クラス A | `0xxxxxxx.・・・` |             8 ビット             |   24 ビット    |  `0.0.0.0 ~ 127.255.255.255`  |
    | クラス B | `10xxxxxx.・・・` |            16 ビット             |   16 ビット    | `128.0.0.0 ~ 191.255.255.255` |
    | クラス C | `110xxxxx.・・・` |            24 ビット             |    8 ビット    | `192.0.0.0 ~ 223.255.255.255` |
    | クラス D | `1110xxxx.・・・` |             4 ビット             |   28 ビット    | `224.0.0.0 ~ 239.255.255.255` |
    | クラス E | `1111xxxx.・・・` |             5 ビット             |   27 ビット    | `240.0.0.0 ~ 255.255.255.255` |
  - [第 8 回　アドレス・クラスとさまざまな IP アドレス：基礎から学ぶ Windows ネットワーク（1/3 ページ） - ＠IT](https://atmarkit.itmedia.co.jp/ait/articles/0301/17/news003.html)
- ネットワークで使うのは A~C
- D はマルチキャストアドレス
- E は実験用のアドレス
- ブロードキャストアドレス
  - ホストアドレスのビットがすべて 1 の IP アドレス

#### ネットワークの構成でクラスを使い分ける

- ネットワークアドレスが多ければ、それだけ表せるネットワークの数が増える
  - しかし、ホストアドレスが減って、つなげられるコンピューターや機器の数が少なくなる
- ネットワークに参加するコンピューターや機器の数に応じて、IP アドレスのクラスを使い分ける
  - |          | ネットワークアドレス | ホストアドレス |
    | :------: | :------------------: | :------------: |
    | クラス A |        126 個        |  約 1600 万個  |
    | クラス B |     約 1600 万個     |  約 65000 個   |
    | クラス C |     約 200 万個      |     254 個     |
- 同じネットワークに参加しているコンピューターや機器は、同じネットワークアドレスを持っている
  - ネットワークが異なれば、異なるネットワークアドレスが必要

#### サブネットマスクでネットワークを分割

- IP アドレスをクラスで分ける仕組みでは、使わない IP アドレスが出てしまって、効率がよくない
  - サブネットマスクという仕組みが必要になった
- ホストアドレスの一部をサブネットワークを表す部分として使うことで、1 つのネットワークアドレスを異なるネットワークで利用できる
  - サブネットの分、ホストアドレスが減るので、表せるホストアドレスが減る

#### クラスレスアドレッシング

- サブネットマスクを使う方法でも、クラスに分けるやり方に変わりなく、効率が良いとは言えない
- クラスに分けること自体をやめる**クラスレスアドレッシング**が登場する
  - 先頭からどこまでがネットワークアドレスかを**CIDR**という表記で表す
  - 任意の単位でアドレスを区切ることができて、IP アドレスを効率的に利用できるようになった
  - `172.16.10.125/24`　 → 　先頭から 24 ビットまでネットワークアドレス

#### グローバル IP アドレスとプライベート IP アドレス

- IP アドレスの種類
  - グローバル IP アドレス
    - インターネットで通用する IP アドレス
    - ICANN（日本では JPNIC）が重複しないように管理している
  - プライベート IP アドレス（ローカル IP アドレス）
    - 1 つのネットワークの中だけで有効な IP アドレス
    - 別のネットワークに同じ IP アドレスがあることもある
- IP アドレスには「この範囲はプライベート IP アドレスとして使う」という範囲が決められている
- プライベート IP アドレスの範囲
  - | クラス名 |              範囲               |
    | :------: | :-----------------------------: |
    | クラス A |   `10.0.0.0 ~ 10.255.255.255`   |
    | クラス B |  `172.16.0.0 ~ 172.31.255.255`  |
    | クラス C | `192.168.0.0 ~ 192.168.255.255` |

### 8 　 IPv6

#### グローバル IP アドレスが足りない

- インターネットの普及にともなって、グローバル IP アドレスが足りなくなる問題が発生した

  - そこで、IP バージョン 6（IPv6）が策定され、IP アドレスの仕組みが大きく変更される

- IPv4
  - 32 ビットのデータ
  - IP アドレスの数は約 43 億個
- IPv6
  - 128 ビットのデータ
  - IP アドレスの数は約 43 億 x 約 43 億 x 約 43 億 x 約 43 億個
  - 16 ビットずつ「：」で区切って 16 進数で表す

#### IPv4 と IPv6 を共存させる

- インターネットは 1 つの企業や団体が管理しているわけではない
  - そのため、ある日を堺にすべてを IPv6 へ切り替えることができない
  - 当面は IPv4 と IPv6 を共存させ、徐々に IPv6 に切り替えていくことになる
  - カプセル化などの技術を使うことで IPv4 と IPv6 を共存させている
  - 一般的に使われている PC やスマホは IPv4 と IPv6 の両方に対応している

#### IPv6 になると必要なくなるもの

- IPv6 では、IP アドレスを節約するための仕組みは必要なくなる
- IPv6 に機能として盛り込まれたことで必要なくなる仕組みもある
  - NAT、NAPT
  - ARP
  - DHCP

#### いろいろなものに IP アドレスを割り当てて活用する

- IPv6 では、IP アドレスの数を気にせず、さまざまなものに割り当てることができる

### 9 　ルーティング

- 最終的にデータを受け取る相手にたどり着くために、どのルートを通ればいいのかを選択する

#### ルートを決めるルーティングは、ルーターが担当

- ルーティング（経路選択）
- ほかのネットワークに参加しているコンピューターや機器との間でデータをやり取りするときに使われる
  - データを送りたい相手にたどり着くためにどのルートを選べばいいかを把握する
- ルーターによって管理される

#### ルーティングテーブルでルートを選択

- ルーターは、送るデータに付いている IP アドレスと**ルーティングテーブル**を見て、どのルートを選べばいいかを判断する
- ルーティングテーブル
  - 「該当するネットワークに参加しているコンピューターや機器に送る上で、どのネットワークのルータに送信するか」の指示が書かれている

#### スタティックルーティングとダイナミックルーティング

- スタティックルーティング
  - ネットワーク管理者が手作業でルーティングテーブルを作る方法
  - 作業は面倒
  - 人間が作るからルーターとネットワークの負担が少ない
  - 小規模のネットワークやルートが決まっているネットワークで使われる
- ダイナミックルーティング
  - ルーター同士が「ルーティングプロトコル」を使って情報を交換し、目的地にルーティングテーブルを作る方法
  - 作業が簡単
  - ルーターとネットワークの負担が大きい
  - 大規模のネットワークで使われる
    - 登録する情報が多いし、変更があったら登録し直す手間がかかるから

#### IGP と EGP

- ルーティングプロトコル
  - ルーター同士がルーティングテーブルに必要な情報を交換するときの決まりごと
- IGP
  - AS（自律システム）内で利用される
- EGP
  - AS 間で利用される
- AS
  - インターネットのように大規模で全体の管理が難しいネットワークを、プロバイダーや企業などの単位で分けたもの

#### ディスタンスベクター型とリンクステート型

- ディスタンスベクター型
  - 隣のルーターとルーティングテーブルの情報を交換する
  - 距離と方向をもとにルートを決める
- リンクステート型
  - すべてのルーターと接続情報を交換して、その情報を元にルーティングテーブルを作る
  - 接続の状態をもとにルートを決める

### 10 　ゲートウェイ

- ルーターは、ルーティング以外にもネットワークの出入り口（ゲートウェイ）の役割をしている

#### ゲートウェイは異なるネットワークへの出入り口

- あるネットワークと他のネットワークをつなぐ出入り口の役割を果たすコンピューターや機器
  - ネットワーク間のデータのやり取り時に必ずゲートウェイを経由する

#### ゲートウェイは複数のネットワークに対応している

- ゲートウェイは、自分のネットワークとほかのネットワークの両方に参加している
  - 採用しているプロトコルが違う場合は、両方に対応する必要がある

#### ゲートウェイとして使われる機器やコンピューター

- ゲートウェイとして機能するコンピューター
  - **プロキシーサーバー**
  - **アプリケーションレベルゲートウェイ**

#### ゲートウェイのグローバル IP アドレスを使ってインターネットを利用する

- 家庭、企業のネットワークとも、参加しているコンピューターや機器にはプライベート IP アドレスを割り当てるのが一般的
  - しかし、このままではグローバル IP アドレスが必要なインターネットは使えない
  - そこで、**ゲートウェイにグローバル IP アドレスとプライベート IP アドレスの両方を割り当てる**
  - 家庭、企業のネットワークとゲートウェイ間ではプライベート IP アドレスでやり取り
  - インターネットとゲートウェイ間ではグローバル IP アドレスでやりとり
  - これで、プライベート IP アドレスしか持っていないコンピューターは、プライベート IP アドレスとグローバル IP アドレスの両方を持っているゲートウェイに頼んで、インターネットを利用する

#### ゲートウェイの IP アドレスをあらかじめ設定

- コンピューターがインターネットなど他のネットワークのコンピューターとデータをやり取りする場合
  - まずゲートウェイにデータを送るためには、**コンピューターにゲートウェイの IP アドレスが設定されている必要がある**
  - 通常は自動的に設定される仕組みが用意されている
- **デフォルトゲートウェイ**
  - 「他のネットワークに送る時、まずここにい送る」と設定されたゲートウェイ
- Mac の環境設定で確認する方法
  - `システム環境設定 > ネットワーク > （接続するネットワークの）詳細 > TCP/IPタブ`
  - `ルーター` にデフォルトゲートウェイの IP アドレスが記載されている
- Mac のターミナルで確認する方法
  - `netstat -nr | grep default` コマンドで確認する

#### NAT と NAPT

- NAT（Network Address Translation）
  - デフォルトゲートウェイがクライアントから送られてきたパケットのヘッダーにかかれている送り主のプライベート IP アドレスを、デフォルトゲートウェイ自身のグローバル IP アドレスに書き換える
  - `クライアント　-パケット（送り主のプライベートIPアドレス）→　デフォルトゲートウェイ（グローバルIPアドレスに書き換える）　→　ほかのネットワーク`
  - この仕組が NAT
  - デフォルトゲートウェイは、**どのクライアントから頼まれたて IP アドレスを変換したかの記録**をとっておく
  - 最終的にデータのやり取りをする相手からゲートウェイが宛先とされているデータが届いたら、記録を参照してデータを頼んだクライアントのプライベート IP アドレスに宛先を変更してデータを送る
  - しかし、この方法では同時に行われるデータのやり取りの分だけグローバル IP アドレスが必要になる
- NAPT（Network Address Port Translation）
  - NAT では効率が悪い
  - そこでグローバル IP アドレスとポート番号を組み合わせて使う
  - これで、同じグローバル IP を使ってポート番号の違いで複数のデータのやり取りができる

#### プロキシーサーバーにはセキュリティと利便性を高める役割もある

- プロキシーサーバー（アプリケーションレベルゲートウェイ）じゃ、トランスポート層からアプリケーション層までのデータが扱えるゲートウェイ
- ゲートウェイとしての役割とセキュリティ効果と利便性を高めることを目的として設置されることが多い

### 11 　イーサネットと無線 LAN

- イーサネット
  - ネットワークインターフェイス層のプロトコルとして広く普及している
  - 有線のネットワークで使われる
  - ノート PC やスマホには無線 LAN を採用するケースも多く見られる

#### ネットワークインターフェイス層の 2 つの役割

- ネットワークインターフェイス層
  - 隣り合った機器の間でデータをやり取りする際の決まりごとを定める（データリンク層）
  - ケーブルや端末、電気信号など、ネットワークの物理的な部分に関する決まりごとを定める（物理層）
    - デジタルデータとアナログデータの変換を行う

#### 有線のネットワークならイーサネット

- **イーサネット**
  - ケーブルで接続する有線のネットワークで使われるプロトコル
  - 有線で接続する機能を持ったコンピューター、機器などで備わっているもの
    - イーサネットの決まりごとに沿ったハードウェア
    - イーサネットで行う処理を実行するソフトウェア
- イーサネットを LAN と呼ぶこともある

#### 無線 LAN のプロトコル「IEEE 802.11」

- **無線 LAN**

  - 電波を使ってデータをやり取りするネットワーク

- **IEEE 802.11**
  - 無線 LAN のネットワークインターフェイス層のプロトコルとして広く普及している
  - 通信速度などが異なるいくつかの種類に分かれている
  - 末尾に `ac` 、 `n` 、 `a` 、 `d` などのアルファベットを付けて区別している
  - 無線 LAN で採用されているプロトコルの名前

#### WIFI、無線 LAN の呼び方を整理しておく

- **Wi-Fi**
  - Wi-Fi Alliance というハードウェアの業界団体が定めるブランド名
- Wi-Fi の認証を受けている機器同士は、**メーカーや種類が違っていても、IEEE 802.11 を採用した無線 LAN で問題なく使用できることを保証している**
- 認証の有無にかかわらず、IEEE 802.11 を採用した無線 LAN でインターネットを利用することを Wi-Fi と呼ぶケースも多く見られる

#### ネットワークインターフェイス層で使われる MAC アドレス

- **MAC アドレス**、**物理アドレス**
  - イーサネットや IEEE 802.11 などがデータをうアリ取りする相手を特定するために使うアドレス
- **EUI-48**
  - 現在広く使われている全 48 ビットの MAC アドレス
  - 先頭から 24 ビットは、OUI（製造メーカー）を表す
  - 残りの 24 ビットは、製造メーカーが個々の機器につける
  - 16 進数で表す
- **EUI-64**
  - 64 ビットの MAC アドレス

#### MAC アドレスはデータのやり取りの途中で次々に変わっていく

- ネットワークインターフェイス層のプロトコルが作るパケットのヘッダーには、**データをやり取りする相手の住所として MAC アドレス**が書かれている
- ネットワークの機器を経由するごとに経由する機器のネットワークインターフェイス層の処理で**直接データをやり取りする相手**の宛先が指定される
- 直接データをやり取りする相手が変わっていくので、やり取りする相手を特定する MAC アドレスも変わる
  - 中継するごとに MAC アドレスが変わって、最終目的地については、別のレイヤーが担当する

#### 最初は MAC アドレスがわからない

- はじめてネットワークに参加した PC やネットワーク機器は、データをやり取りする相手の MAC アドレスを知らない
- **ARP**というインターネット層のプロトコルを使って、MAC アドレスを調べる
- ARP
  - 最初に知りたい IP アドレスを持っている機器から MAC アドレスを教えてもらうように、ネットワークに参加しているすべての機器にブロードキャストで問い合わせる
  - ブロードキャストアドレスは、48 ビットがすべて 1 の「FF-FF-FF-FF-FF-FF」
  - 指定された IP アドレスを持つ機器だけが返信する
- 最終的にデータをやり取りしたい相手が同じネットワーク内にいない場合、デフォルトゲートウェイが直接データをやり取りする相手となる
  - デフォルトゲートウェイの IP アドレスを指定して、知りたい IP アドレスを持っている機器から MAC アドレスを教えてもらうように、問い合わせをする

### 13 　 DHCP で接続情報を自動設定

- **DHCP**
  - ネットワークを利用するために必要な情報を自動的に取得して設定するためのアプリケーション層のプロトコル

#### IP アドレスはいつ、誰がつけるのか

- TCP/IP を採用しているネットワークでは、参加しているすべての PC やサーバー、機器に、**識別子として IP アドレス**が付けられる
- しかし、ネットワークに接続しているユーザーが個別に IP アドレスを設定することはない
  - 接続に必要な IP アドレスなどの情報を自動的に割り当てる DHCP（Dynamic Host Configuration Protocol）というサービスを利用しているため

#### DHCP サーバーに情報をもらって自動的に設定

- はじめてネットワークに参加するクライアントは、そのネットワークにある DHCP サーバーから、**自身の IP アドレス**や**デフォルトゲートウェイの IP アドレス**などの情報をもらって、自動的に設定する
- DHCP からもらう情報
  - クライアントが使う IP アドレス
  - サブネットマスク
  - デフォルトゲートウェイ
  - DNS サーバー（フルサービスリゾルバー）の IP アドレス
  - など
- DHCP サーバーとクライアントがデータのやり取りをお始めるときは、お互いの IP アドレスがわからない
  - そこで、ブロードキャストを使って DHCP サーバーを探す
  - DHCP サーバーは、クライアントの MAC アドレス宛にユニキャストで返事する

#### IP アドレスの範囲と貸し出し期限

- あらかじめ指定された IP アドレスの範囲「**アドレスプール**」から使っていない IP アドレスを 1 つ選んでクライアントに割り当てる
  - 割り当てられた IP アドレスにはいつまでつかえるかの期限が決められている
  - 期限が切れると、クライアントは再度 DHCP サーバーに連絡して新しい IP アドレスをもらう
- 期限がある理由
  - 割り当てたのに使っていない IP アドレスがあると、非効率的だから

#### DHCP サービスのメリット

- ユーザーは面倒な設定を行うことなくネットワークを利用できる
- ネットワーク管理者も管理の手間が省ける
- 固定で IP アドレスを付けておきたいサーバーや機器の場合
  - DHCP サーバーの設定できる
  - DHCP サーバーを使わず、サーバーや機器に IP アドレスなどの情報を直接指定することもできる

#### 家庭用のルーターには、DHCP が備わっている

- 家庭のネットワークで使われているルーターは、一般的に DHCP サーバーとしての機能も併せ持っている

---

## 3 章　データを活用するための技術

### 1 　ネットワークサービスを知ろう

#### アプリケーション層はユーザーとネットワークの橋渡し役

- ユーザーが入力したデータやネットワーク経由で受け取ったデータを適切に処理して、ユーザーが活用できるようにする役割を持つ

#### ネットワークサービスとは

- アプリケーション層のプロトコルに対応したクライアント側のソフトウェアがそのプロトコルに沿ってデータを適切に処理し、ユーザーが利用するもの

#### サーバー側ソフトもアプリケーション層のプロトコルに対応

- サーバー側でもアプリケーション層プロトコルに対応したソフトウェア（サーバーソフト）が動作している

### 2 　 Web サービスの基本

#### ほとんどのインターネット利用は Web サービスのこと

- Web サービス
  - HTTP を採用している
  - WWW の仕組みで表現している

#### HTTP を使ったデータのやり取りはシンプル

- Web サービスのアプリケーション層のプロトコル
  - HTTP を使う
  - クライアントは HTTP リクエストを送り、サーバーは受け取る
  - サーバーは HTTP レスポンスを送り、クライアントは受け取る

#### HTTP レスポンスにはデータを適切に扱うための情報が付いている

- HTTP レスポンス
  - クライアントに送るデータ本体
  - データのやり取りの状況を知らせるステートコード
  - データ本体の種類や更新日時などの情報を知らせるヘッダー
  - などが含まれている

#### WWW の仕組み

- WWW（World Wide Web）
  - ネットワークを買入してドキュメントを公開するための方法を定めたもの

### 3 　 Web サイトのしくみ

#### Web サイトの基本的な作り方

- 公開したいデータを用意する
- ソフトウェアで Web ページを作る
- Web サーバーの所定のフォルダーに保存する
- Web サイトとして公開する

#### Web ブラウザーとは

- Web サービスを利用するためのソフトウェア
  - データを送ってほしい Web サーバー宛に HTTP リクエストを送る
  - 送られてきたデータを HTML/CSS などの決まりに沿って表示する

#### CMS とは

- CMS を利用することで、Web サイトを作成した後の管理が簡単になる
  - CMS を Web サーバーに導入
  - CMS を使って Web サイトのデザインや構成を決めて公開
  - CMS を使って Web サイトを更新

### 4 　 SNS のしくみ

- SNS
  - ユーザー同士のコミュニケーションをはかるのに便利な機能を持った Web サービス

#### SNS も Web サービス

- ユーザー同士のコミュニケーションの場としての役割を持っている
- Web サイト
  - ユーザーに情報を伝えたい
- SNS
  - コミュニケーションの場として使ってほしい

#### 見た人の反応を目に見えるかたちに

- SNS の機能
  - ユーザーが情報を手軽に発信する機能
    - 短い文章や絵文字でコミュニケーション
    - 見た人がコメントを残す
    - 引用できる機能
  - 発信した情報に対する反応がわかる機能
    - 相手が見たかわかる
    - 誰が見たかわかる
  - 交友関係を表示

#### ほかのコンテンツをおすすめする機能も

- ほかのユーザーが発信した情報やニュースサイトの記事など、自分が興味を持ったコンテンツを引用できるのも SNS の特徴

### 5 　動画配信のしくみ

- 動画配信の形式
  - ダウンロード
  - ストリーミング
  - プログレッシブダウンロード

#### 保存してから再生するダウンロード

- 動画ファイルをネットワーク経由でダウンロードして保存してから再生する方法
- ダウンロード完了まで再生ができない
- 使用するプロトコル
  - HTTP

#### ダウンロードしながら再生するストリーミング

- 動画のデータをダウンロードしながら再生する
- ダウンロードが完了する前に再生を始められる
- 専用のプロトコルを使う
  - サーバーとクライアントでストリーミングプロトコルに対応したソフトを用意する必要がある
  - RTSP、MMS、RTMP、HLS など
- **再生したデータは順次破棄される**

[HTTP Live Streaming, HLS のまとめ　概要・仕組み・課題など | Agora 開発者ブログ | ブイキューブ](https://jp.vcube.com/sdk/blog/hls-http-live-streaming.html)

#### 手軽だがファイルが残るプログレッシブダウンロード

- プロトコルに HTTP を使いつつも、ストリーミングのように届いたデータから順次再生していく形式
- 再生した動画はクライアント側にファイルとして残る

### 6 　ネット検索のしくみ

#### ディレクトリ型とロボット型

- 検索結果のもとになる情報を集める方法によって分かれる
  - ディレクトリ型
    - 人間が手動で情報を収集
  - ロボット型
    - ロボット、クローラーなどと呼ばれるプログラムが、自動で情報を収集
- 現在はネット検索サービスの大半がロボット型

#### ロボット型検索サービスの仕組み

- ロボット型
  - インターネットで公開されているデータをプログラムによって自動で収集し、整理する
    - 内容を収集して、リンクをたどって、他のページに移動する
    - さらに収集して移動することを繰り返す
  - 収集・整理したデータをもとに検索結果をユーザーに提供する
    - ロボットが収集した情報を解析する
      - インデックスを作成して DB に保存する
    - ユーザーが検索したキーワードをもとにどのコンテンツを検索結果の上位にするかを決めるアルゴリズムに沿って処理する

### 8 　クラウドのしくみ

#### クラウドはインターネットの活用法

- クラウドの由来
  - インターネットを図で表すときに雲の形の絵を使うことから来ている
- クラウド
  - **インターネットの側にあるものを活用すること**

#### クラウドで画像共有

- 画像をサーバーに保管して共有するサービスが挙げられる
- インターネットの側に画像を保管することで、複数の端末、複数のユーザーからその画像を活用することができる

#### クラウドで画像加工

- 画像の保管・共有サービスを応用して、インターネット側で画像を加工することもできる
- 画像加工ソフトをインストールする必要もなく、使用する機器を選ばない
  - 画像加工の指示のみ行い、処理自体はサーバーに任せる

#### ビジネスでのクラウド

- 仕事で必要なファイルサーバーに保管して、外出先で利用したり、同じ仕事をしている人たちで共有したりできる

#### SaaS、IaaS、PaaS の違い

- SaaS
  - クラウドを通してさまざまなサービスを提供することを目的としたクラウドの活用法
- IaaS
  - 技術者に向けてハードウェアやネットワークを提供するクラウドの活用法
- PaaS
  - 技術者に向けてハードウェアやネットワーク、開発環境を提供するクラウドの活用法

#### クラウドのメリット

- 必要なデータやデータを処理する機能はインターネットの側にある
- インターネットに接続できる機器と接続環境があれば、いつでもどこでもそのデータや処理機能を活用できる

#### クラウドのデメリット

- インターネットに接続していないと利用できない
- 利用しているクラウドサービスが将来的に利用できなくなる可能性もある
  - 重要なデータは手元の機器にコピーしておいて、クラウドが使えなくなった場合のことも考えた対策が必要

---

## 5 章　ネットワークのセキュリティ

### 5 　ファイアウォールでネットワークを守る

#### ゲートウェイにセキュリティ機能をもたせたファイアウォール

- ファイアウォール
  - ゲートウェイに、危険なデータかどうかを判断して処理するセキュリティ機能をもたせたもの
  - 内部から外に出ていくデータも危険と判断したらストップ
- 不正侵入対策の基本
- インターネットに接続している LAN には、必ず必ずファイアウォールを設置する
- マルウェア対策の機能を持ったファイアウォールを設置している企業ネットワークもよく見られる

#### ファイアウォールの種類

- OSI 参照モデルのどのレイヤーまでチェックするかで分かれる
  - ネットワーク層まで
    - **パケットフィルタリング**
    - イーサネット、無線 LAN と IP まで
    - データの中身はチェックしない
  - トランスポート層まで
    - **サーキットレベルゲートウェイ**
  - アプリケーション層まで
    - **アプリケーションレベルゲートウェイ**
    - データの中身もチェックして通す/通さないを判断できる
    - **プロキシーサーバー**とも言う

#### ファイアウォールを導入する

- ゲートウェイをファイルウォールとして機能させるには、ファイアウォール用のソフトウェアを導入する
  - あらかじめ導入されたものもある
- 家庭用のルーターには、パケットフィルタリングのソフトウェアが組み込まれていることが多い

#### インターネットに公開するサーバーがあるなら DMZ を設置する

- インターネットに公開するサーバーを設置する場合、DMZ（DeMilitarized Zone）を設ける
  - 社内ネットワークから隔離されたセキュリティ上のエリア
- インターネットに公開するサーバーは、DMZ の中に設置する

### 6 　プロキシの導入

- プロキシー
  - 代理という意味
  - クライアントの代理となる通常のプロキシー
  - サーバーの代理となるリバースプロキシー

#### データを代理としてやり取りする

- ネットワークサービスの 1 つ
- クライアント、サーバーの代理としてデータをやり取りする
- Web サービスのデータを代理でやり取りするのが一般的
- プロキシー機能は、さーばーとして導入される

#### プロキシーサーバーでパケットがデータになる

- プロキシーサーバーの特徴
  - 代理として売っけ取ったパケットを、いったんデータに戻して、パタパケットにして送り出す

#### セキュリティのためにプロキシーサービスを導入する

- 代理でパケットからデータに戻したときに、データの中身を確認して安心かどうか判断する
  - クライアントが危険な相手と直接データをやり取りしなくて済む
  - 危険な相手からすると、攻撃対象の情報を集めたいのにプロキシーサーバーの情報しかわからない状態になる

### 7 　データを暗号化する SSL/TLS

- SSL/TLS プロトコルを使って、データをやり取りする
- 暗号化、ハッシュ、サーバー証明書の仕組みを使う
  - 盗み見、改ざん、なりすましを防ぐ

#### ネットワークを行き来するデータは暗号化されていないのが普通

- インターネットをはじめとしたネットワークでは、VPN などのセキュリティを高める対策を講じない限り、データは暗号化されない
  - データのやり取りの途中で盗み見などの被害に遭う可能性がある

#### SSL/TLS はアプリケーション層の下に位置するプロトコル

- SSL/TLS は OSI 参照モデルのセッション層にある
  - アプリケーション層の下の層、TCP もしくは UDP の上の層になる

#### SSL/TLS は 3 つの危険からデータを守る

- 盗み見を防ぐ暗号化
  - 公開鍵、秘密鍵を使ってデータを暗号化
- 改ざんを防ぐハッシュ
  - データを元に計算したハッシュ値を一緒に送る
  - 受け取った側でも計算してハッシュ値が同じならデータは改ざんされていないと判断する
- なる済ましを防ぐサーバー証明書
  - サーバー証明書があるかどうかで、偽サーバーではないことを確認する

### 8 　無線 LAN のセキュリティ

#### 無線ならではの危険性

- 電波の届く離れた場所から勝手にネットワークを使われたり、機密データを盗まれたりする危険性がある

#### 無線 LAN のセキュリティ規格

- 無線 LAN で採用されているセキュリティ規格
- IEEE が策定
  - WEP
    - 脆弱性があり、採用すると危険
  - **IEEE 802.11i**
    - IEEE が WEP の後続として策定
- Wi-Fi Alliance が策定
  - WPA
    - 脆弱性がある WEP の代わりとして Wi-Fi Alliance が作ったセキュリティ規格
  - **WPA2**
    - 完成した IEEE 802.11i を反映したもので、仕組みは IEEE 802.11i と基本的に同じ
- 使っている機器が WPA2 もしくは IEEE 802.11i を使っているかを確認する

#### 採用する技術や方式の名前を併記する

- 規格によって利用する仕組みを選べるため、どの仕組みを使うかを規格名と一緒に表記する
  - `WPA-PSK(AES)` だと、PSK がユーザー認証、AES が暗号化の仕組みを表す
  - WPA2 の暗号化、改ざん防止の仕組みは「CCMP」
    - CCMP が使っている暗号化の仕組みが AES
  - WPA2 では、ユーザー認証の仕組みとして PSK または IEEE 802.1X を使う
    - PSK はパーソナル、IEEE 802.1X はエンタープライズとも呼ぶ
- 一般的に使われている PC、スマホは IEEE 802.1X に対応している

#### セキュリティの設定は WPA2(AES)に

#### SSID に会社の情報、ネットワーク情報を含めない

- SSID
  - アクセスポイントの識別子
  - 他のアクセスポイントと区別するための名前
  - 会社の情報やネットワークの構成がわかるような名前を付けないようにする
