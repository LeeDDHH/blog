# Web 技術のしくみ

- Web 技術に関する基本的な地磁気を身に着けたい
- Web サイトや Web アプリケーションなどを始めたいと考えている
- クラウドも含めて用語や技術、動向などを確認したい
- Web を活用したビジネスを検討している

## Web 技術の基本

### Web システムの構造

- デバイス（ブラウザ）、インターネット、Web サーバーが基本の構成

- Web サイト
  - 文書情報を中心とした Web ページで構成される集合体
- Web アプリ
  - 動的なしくみを指す
  - Web サーバーに加えて、アプリケーションサーバー（API サーバー）、データベースサーバー（DB サーバー）などが加わる
- Web システム
  - web サイトと Web アプリに加えて、API などで個別のサービスを提供するなど、やや複雑で規模の大きい仕組み
  - 外部システムとの連携、自動での情報取得、IoT デバイスの利用など

### Web ページを閲覧する

- ユーザーに向けた専用アプリの存在
  - アプリを立ち上げるとすぐに URL からアクセスできるようになっている
  - 別のサーバーなどと自動的に特定のデータをやりとりするような使い方もできるようになっている

### URL とは?

- スキーム名、FQDN（Fully Qualified Domain Name）（ホスト名とドメイン名の組み合わせ）、パス名で表す

  - スキーム名　：　 https://
  - FQDN 　：　www.example.com
  - パス名　：　/about

- ドメイン名とは？

  - インターネットの世界の中で一意の名前
  - 対になるグローバル IP アドレスを持っている

- 主なドメイン名
  - ドメイン名は、主に[gTLD](https://www.nic.ad.jp/ja/basics/terms/gtld.html)と国ごとに割り当てられた[cc(country code)TLD]](https://www.nic.ad.jp/ja/basics/terms/ccTLD.html)などがある
  - gTLD の例
    - .com 　：　誰もが登録できる商業組織向け
    - .net 　：　誰もが登録できるネットワーク用
    - .org 　：　団体、協会などの法人で使われることが多い
    - .edu .gov 　：　教育や政府機関など組織としての要件が必要
    - .boz .info .name .pro 　：　誰でも登録できるビジネス用、個人用、士業向けなどの特性がある
  - JP ドメインの ccTLD の例
    - .co.jp 　：　会社法人のスタンダード
    - .or.jp .ac.jp .go.jp 　：　財団、社団、学校法人、政府機関

### Web サーバーの外見と中身

- Linux が増えている理由
  - Windows server には多くの機能が実装されていて、必要な機能を比較的簡単に設定できるが、メンテナンスを含めてそれなりの費用がかかることがある
  - Linux の場合、Windows より少しむずかしくなるが、必要な機能だけを追加していくので、ディスクの節約や安定性の向上に加えて、コストも安価に抑えられる

### ブラウザとは別の存在

- API とは?
  - 異なるソフトウェアがやりとりをする際のインタフェースの仕様を意味する言葉

### web サイトの規模

- Web サイトの規模を測る数値として総ページがある

  - 小規模　：　 100 ページ以内
  - 中規模　：　 100~1000 ページ以下
  - 大規模　：　 1000 ページを超える
  - 超大規模　：　 10000 ページを超える

- ページ数のカウントの例
  - Google の `site:` コマンド
  - `site:example.com`

---

## Web 独自のしくみ

### Web 技術の移り変わり

- 広がる利用領域

  - 以前の情報システムは `SoR（System of Record：記録のシステム）`
    - 利用する組織での管理を中心としていた
  - 現在は、 `SoE(System of Engagement：つながるシステム)`
    - さまざまな組織や個人のつながりも視野に入れたシステムを目指す取り組みが増えている
  - 閲覧中心であった Web サイトから、さまざまな情報を収集して活用する Web アプリやシステムへの変化

- 変わる開発スタイル
  - 独自性や専用性を重視するしくみから、汎用性や可用性を習字する仕組みに変化
  - ゼロベースで開発する時代から、開発基盤やフレームワークを利用する、さらに、すでに存在するサービスや API も利用する
  - プログラミングにこだわらず、コードをできるだけ書かないローコードやノンコードによる開発のスタイル
  - 情報をっ活用することを目指すと、さまざまな情報やシステムとのつながりが重視され、それらの実現がさらなるつながりを生み出す好循環となって市場は拡大していく

### Web サイトの表と裏

- 見た目が重要なシステム
  - ユーザーが得られる満足する体験を設計する UX デザインを目指すことが多い
  - デザインや画面の動線が重要視されるようになり、見た目が重要になってきている
  - web 開発では見た目と機能を両輪として進めていく特徴がある
  - 業務システムでは、設計通りの機能の実現が重視される

### 変化しないページと変化するページ

- 静的ページと動的ページ

  - 静的ページ
    - 記述された文書の表示が主体となる固定的な動きのないページ
  - 動的ページ
    - ユーザーからの入力やユーザーの状況に応じて、出力する内容が動的に変化する Web ページ

- 動的ページの例
  - 検索エンジン、掲示板、SNS、アンケート、オンラインショッピング

### Web サイトの裏側

- HTTP リクエスト

  - HTTP では、一意の URL を相手として指定して通信する
  - 1 回ごとに相手とのやり取りを完結させる `ステートレス` という特徴がある
  - HTTP メッセージの中で、HTTP リクエストとレスポンスが実行される
    - これが、1 対 1 の関係でステートレス性が担保される
  - HTTP リクエストに使う HTTP メソッド
    - GET、POST、PUT、CONNECT などがある
  - ブラウザから Web サーバーにどのようなリクエストを送るのか
    - HTTP プロトコール > HTTP メッセージ > HTTP リクエスト > GET、POST のような HTTP メソッド

- HTTP レスポンス
  - リクエストを送った相手側の Web サーバーの情報や、リクエストがどのように処理されたかどうかを示すステータスコードが含まれる

### プログラムの起動

- 動的ページでは、 `データの入力 > 処理の実行 > 結果の出力・表示` となる

  - これらの一連のプロセスのゲートウェイでもあり、トリガーとなる仕組みは、CGI(Common Gateway Interface)と呼ばれる
  - ブラウザ側で入力されたデータを送る際に、Web サーバーにある CGI プログラムを同時に呼び出す
    - HTML ファイルなどに起動する CGI のファイル名をあらかじめ入れておく
    - CGI プログラムが起点となって処理を実行し、結果の出力も行う

- CGI の使われ方
  - 静的ページが多数はだった時代に、動的なページを実現するための取り組みの中で生まれてきたしくみ
  - しかし、CGI では 1 回 1 回別のプログラムの起動やファイルのオープンやクローズなどを必要とするため、多数のユーザーを相手にする大規模な Web サイトの処理には向かないこともある

### 再接続を支援するしくみ

- Cookie
  - Web サーバーがブラウザに対する HTTP レスポンスの中に Cookie を含めて送信する
  - ブラウザが Cookie を送ってきた Web サーバーに再びアクセスすると、Web サーバーはその Cookie を読み取って、一見（いちげん）のユーザーとは異なる対応をする
  - 利用に際しては、ブラウザ側で Cookie を含めたやり取りを許容する設定をする必要がある
  - 2020 年 6 月に成立した改正個人情報保護法では、企業が個人と Cookie 情報をあわせて利用する場合には個人の同意を得ることが義務付けられている

### 一連の処理の開始から終了までの管理

- Session

  - Session 自体は、端的には処理の開始から終了までを意味する
  - サーバーや Web アプリ側で管理する
  - 複数の Web ページやアプリケーションを連携するためにサーバーに情報を保存してブラウザとやり取りをするしくみ
  - Cookie の中に、一連の処理を表す一意の SessionID を含める形で、ブラウザとサーバーのやり取りが進められていく

- Session を一意に表す ID
  - ブラウザからのアクセスが会った際に、サーバー側で Session スタートを宣言することからはじまる
  - SessionID は Cookie をっ通じてやり取りするが、万が一、別のユーザーに SessionID を取られても問題が発生しないように、意味を持たない英数字の羅列などで生成される
  - SessionID とユーザーの状況などはサーバー側で紐付ける
  - Session の管理自体はパターン化された処理でもあるため、実際の開発ではフレームワークを利用することが多い

---

## Web を支えるしくみ

### Web 全体を支えるしくみ

- サーバーの種類

  - Web サーバー
  - FTP サーバー
  - DNS サーバー
  - Proxy サーバー
  - SSL サーバー
  - SMTP サーバー
  - POP3 サーバー
  - などなど

- Web サーバーまでの道
  - ユーザーの PC からは DNS や Proxy サーバーなどのしくみを経由して、求める Web サーバーのネットワークにいく

### IP アドレスと MAC アドレス

- IP アドレス

  - インターネット上で、デバイスと Web サーバーなどのコンピューター同士がお互いに IP アドレスで呼びかける
  - コンピューターのソフトウェアが認識するネットワーク上の住所
  - **ネットワークで通信相手を識別するための番号**
  - IPv4 では、2 の 32 乗（約 43 億）の IP アドレスが利用できる
  - IPv6 では、2 の 128 乗（約 340 潤）の IP アドレスが利用できる
  - IoT システムの導入が進んで、各種センサーやデバイスのインターネット接続が進むようになると、IPv4 では IP アドレスが枯渇して、IPv6 への切り替えが進む

- MAC アドレス
  - 各デバイスが持っているハードウェアが認識する住所
  - **ネットワーク内での機器を特定するための番号**
  - 接続したいコンピューターの IP アドレスを指定して進んでいく
    - アプリケーションが IP アドレスを指定して、OS 内の IP アドレス帳をもとに MAC アドレスを確認する
    - アドレス帳で探せなかったら、ローカルネットワークでつながっているコンピューターに対して対象の IP をもつ MAC アドレスがないか呼びかける
    - IP が存在したら、そのコンピューターの MAC アドレスを OS 内の IP アドレス帳に記録し、IP アドレスを返す
    - それでも IP が存在しなかったら、他のネットワークあるいはインターネットの世界にも呼びかける

### IP アドレスを付与する

- DHCP の概要

  - 通信するための相手の IP アドレスが分かっているとしても、相手から見たときの自分の IP アドレスが必要になる
  - DHCP（Dynamic Host Configuration Protocol）がその役割を担う

- IP 割り当ての流れ

  - 企業内のネットワークで新たなコンピューターを接続する際に、IP アドレスを追加で付与する必要がある
  - ネットワークへ新たに接続されたクライアント PC では、サーバーの OS に存在する DHCP サービスへアクセスして自身の IP アドレスや DNS サーバーの IP アドレスなどを取得する
  - DHCP 側では、新たに接続されたクライアント PC に対して、定められた範囲の中から使われていない IP アドレスを付与する

- IP アドレスの動的な割り当て
  - 企業内のサーバーやネットワーク機器などでは重要な存在で役割も変わらないことから、固定の IP アドレスを付与する
  - クライアント PC は DHCP による動的な割り当てが一般的
  - 割り当てられた日時が異なると端末が同じでも IP アドレスが異なることがある
  - IP アドレスの割り当てに際しては、合言葉のように「DHCPxx」をつけてやりとりをする

### ドメインと IP アドレスをつなぐ

- DNS（Domain Name System）

  - ドメイン名と IP アドレスを紐付けてくれる機能
  - ブラウザで入力されたドメイン名を IP アドレスに変換する
  - メールアドレスの@以降にあるドメイン名を IP アドレスに変換する

- DNS の存在
  - ユーザー数やネットワークシステムの規模に応じて存在そのものが変わる
  - DNS キャッシュサーバーと DNS コンテンツサーバーがある
  - メールや Web サーバーに DNS 機能が存在するケース（外部の DNS サーバーを利用）
  - DNS の多重化

### インターネットの通信の代行

- インターネット通信の代理と効率化

  - ユーザーが企業の内部から Web サーバーにアクセスするケース、個人が ISP を通じて Web サイトにアクセスするケースでは、端末の IP アドレスが表に出ることはない
  - この場合、Proxy サーバーが各クライアントからするとインターネット通信の代行をする
    - 内部のネットワークとインターネットの間でアクセスの中継をしている
  - 同じサイトへのアクセスのリクエストがある場合、1 台目の Proxy のキャッシュで対応して、2 台目以降は効率化を図る

- Proxy の役割
  - ファイアウォールとしての役割
    - Web サイトによって閲覧できなくする/禁止マークが表示する
    - 外部からの適切ではないアクセスに対してクライアントを守るようにブロックする
  - アクセスしたユーザーが誰なのかわからないようにする
    - 同じ企業やネットワークなどから多数のアクセスがあっても、同じ IP アドレスにしか見えず、分析が限定されることがあり得る

### ブラウザと Web サーバー間の暗号化

- 通信の暗号化

  - SSL（Secure Sockets Layer）
  - インターネット上の通人を暗号化して、**悪意のある第三者からの盗聴や改ざん等を防ぐ**ことを目的とする

- SSL の流れ
  - SSL での通信を行うことをサーバーとクライアントの両者で確認することからはじめる
  - 確認後、サーバーから証明書と暗号化に必要な鍵を送って、通信する二者に固有の暗号と複合の準備ができたら、データの通信が進められる
  - とくにユーザー側で意識することはない

### Web サーバーを構築する方法

- レンタルサーバー

  - 独自のドメイン名を取得して、そのまま ISP が提供する Web サーバーをレンタルする
  - もっとも噛んったんで迅速な方法
  - ユーザーがすぐに使える状態で提供される

- クラウドサービス

  - サーバーやネットワーク機器などを自社で持たない
  - サーバーの構成、ソフトウェアのインストールや設定などの作業は自ら実施

- 自社の施設内での構築
  - IT 機器、ソフトウェアのメンテナンスにコストを要する

|                |                                            レンタルサーバー                                            |                                               クラウドサービス                                               |                                                                                   自社内で構築                                                                                   |
| :------------: | :----------------------------------------------------------------------------------------------------: | :----------------------------------------------------------------------------------------------------------: | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|   選定の基準   |              ディスク容量<br>DB への同時アクセス数<br>SSL その他の有無などで価格が決まる               |          CPU とメモリでサーバーを選定<br>ディスクも選定<br>その他は細かいメニューから付け足していく          | 性能見積もりをしてサーバーを選定<br>ディスクも選定<br>必要なソフトウェアをインストール<br>環境構築や設定を自ら、あるいは委託した企業に任せる<br>自らメンテナンスをする必要がある |
| 代表的な事業者 |                                GMO、エックス、さくらインターネットなど                                 |                             AWS、GCP、Azure、富士通、IBM、ニフクラ、BIGLOBE など                             |                                                                            IT ベンダーとの取引で購入                                                                             |
|     その他     | 年額で 2 万円前後<br>各社ともクラウドサービスと称しているが、以前からの ISP のサービスを原則としている | 無償利用機関のあることが多い<br>料金はレンタルサーバーより高くなる<br>自ら設定は行うが、細かい機能設定が可能 |                                                 コストはもっともかかる<br>スキルがないと実現できないが、自らの好きなようにできる                                                 |

- 使い方の例
  - Web サーバーやメールサーバーなどに限定するのであれば、レンタルサーバー
  - 他のシステムも含めてクラウド化をすすめるのであればクラウドサービス

### Web サーバーを立てる

- Web サーバーを立てる手順の概要

  - すでにネットワークが存在していて、セキュリティ対策が講じられている場合、大まかな手順は以下
    - OS の最新化
      ```
        sudo yum update
      ```
    - Web サーバー機能のインストール
      ```
        sudo yum install httpd
        sudo systemctl start httpd.service
        sudo systemctl enable httpd.service
      ```
    - ネットワーク設定
  - `systemctl` はサービス管理を意味する
  - FTP の機能が必要な場合、 `sudo yum install vsftpd` などでインストールして起動する
  - 自らサーバーを立てるとき、必要な作業

- Linux の Web サーバーのお約束ごと
  - Web サーバーの特定のディレクトリなどに書き込みができる権限（パーミッション）の設定をする必要がある
    - `chmod` はアクセス権（パーミッション）の設定・変更のコマンド
    - `775` は、所有者と特定のグループがファイルやディレクトリの**読み取り**、**書き込み**、**実行**のすべての権限を持つが、その他の利用者は、**読み取り**、**実行**のみに制限される
  - 使用するサーバーの種類に応じて、 `var/www/html` のようなディレクトリ配下に html などのファイルをアップロードする必要がある

### Web サーバーを作る

- Web サーバー稼働までの工程
  1. アカウントの作成
  2. サーバーの作成
     2-1. CPU とメモリなどでリストから選ぶ
     2-2. ディスク容量を決める
  3. 作成した t サーバーへのセキュアな接続の準備
     3-1. 管理者などとして特定した端末で SSH 接続
     3-2. 認証用の特別なファイルを作成
     3-3. ファイアウォールの設定
  4. OS の最適化と Apache のような Web サーバー機能のインストール
  5. HTTP プロトコルでサーバーへ接続できるようにする
     5-1. 一般ユーザーが Web サイトを見られるようにする
  6. 固定の IP アドレスの割り当てとサーバーへの紐付け
     6-1. 固定の IP アドレスを取得して、サーバーに紐付ける
     6-2. ドメイン名と IP アドレスの紐付けをする
  7. コンテンツのアップロード
     7-1. パーミッションの設定やコンテンツのアップロードで閲覧可能にする
- 1 と 2 がもっとも気を使う作業
  - オンラインマニュアルなどに事前に目を通してから作業する、各工程でミスしないことが重要なので、工程ごとにスケジュールを組んで計画的に行う

---

## Web の普及と広がり

### SNS の裏側

- 管理者と開発者の視点で見る
  - インスタグラムのインサイト
    - いいねの数、プロフィールへのアクセス数、投稿を見たアカウント数などが閲覧できる

---

## Web と異なるシステム

### Web にできないシステム

- Web と異なるシステム

  - 主に、インターネットを利用しないシステムについて

- Web 化しやすいシステム
  - システムの規模にかかわらず、外部ネットワーク接続あり
- Web 化しにくいシステム

  - 内部ネットワークにクローズしたケース

- 小規模なオンプレミスのシステム

  - 小規模でユーザーが限定されている部門内などにおけるオンプレミスのシステム
  - 自社で IT 機器との他の IT 資産を保有して、自らが管理している敷地内に設置して運用する形態
  - オンプレミスのシステムの中でも、Web に移行しない・できないシステムは外部のネットワークに接続しない形態のもの

- インターネットを利用するシステム

  - さまざまな場所や異なるネットワークから接続できることが大きなメリット

- システムの規模と Web 化に関係はない
  - 外部ネットワークに接続する必要がないというより、内部のネットワークにクローズしたいシステムと言い換えたほうが適切

### 止めることができないシステム

- 交通機関システム

  - 交通機関の運行を管理するシステムは、各社のクローズされた専用のネットワークの中で動いている
  - 管制室に届く駅や電車などからの情報に万一遅延が生じると、全体の運行に支障が出るので、インターネット接続に切り替えることができない
  - 自動改札機と IC カードである程度の処理ができる/システムのブロックごとに分業化が進んでいることから、部分的にインターネット通信にできる可能性はある

- 電力会社のシステム

  - インター姉と経由での通信のようなタイムラグや何らかの原因での通信エラーがあると、電力の共有が止まる時間や頻度が増える可能性があり得る
  - 社会基盤インフラに関わるシステムは、24 時間 365 日止めることができないので、**ミッションクリティカルなシステム**と呼ばれる
  - 業務自体やユーザーが許容できるレスポンスタイムが極めて短い

- 銀行取引のシステム

  - 現金の動きがある限りは止めることができないシステム

- クラウド化が進みつつある医療の世界

  - 産業界での ERP に相当する最重要なシステムとして電子カルテシステムがある
  - ミリ秒の世界でのレスポンス要求ではないことやもともと病院が強固な専用ネットワークを保有していないことが背景にある

- Web 化への鍵や可否は、**レスポンスタイム**と**独立ネットワークの必要性**にある

### 既存システムのクラウド化の障壁

- 既存システムが仮想サーバーでないとクラウドサービスへの移行で苦労する

- 仮想化のソフトウェア
  - VMWare、Hyper-V、Xen、KVM、Docker など

### インターネット以外のネットワーク

- 企業や団体のネットワークの基本

  - 内部のネットワークの基本は**LAN（Local Area Network）**
  - 拠点間は、キャリアが提供する通信網**WAN（Wide Area Network）**
  - LAN や WAN で構成される企業内ネットワークは**イントラネット**
  - 従業員などによる外部からの接続は**VPN（Virtual Private Network）**

- LAN が残る理由
  - データ通信の品質、セキュリティの観点で使われる

### サーバーの機能の違い

- オフィスで一般的なファイルサーバー

  - クライアント PC が Windows で、サーバーが Windows Server であれば、「ファイルサーバー」と「ファイルサーバーリソースマネージャー」の追加が必要になる
  - サーバーが Linux なら、Samba のインストールや設定が必要になる
  - ネットワークの接続も LAN が前提となる

- Web サーバーには内部のシステムは同居しない
  - Web サーバーの機能は、Web サーバーにアップロードされたコンテンツを、インターネット経由で閲覧できるようにする
    - ファイルサーバーと一部近い機能はあるもののまったく異なるシステム
  - 不特定多数の外部の端末から接続を受けることができる Web サーバーの中に、内部のネットワークで共有する各種業務のファイルを置くことや、ファイルサーバーの機能を同居させることは基本的にない

---

## クラウドとの関係

### クラウドの概要と特徴

- クラウドとは？

  - 情報システムならびにサーバーやネットワークなどの IT 資産をインターネット経由で利用する形態

- クラウドサービスの特徴
  - 利用に関する特徴
    - 従量課金
    - 利用料の拡大や縮小が用意
  - IT 機器やシステムに関する特徴
    - IT 機器や関連設備はクラウド事業者が保有
    - 機器や設備などの運用はクラウド事業者が行う
    - セキュリティや多様な通信手段への対応が整備されている
  - 変化が想定される、先の見通しが立てにくいサービスやシステムなどに適している

### クラウドのサービスの分類

- IaaS（Infrastructure as a Service）

  - 事業者が提供するもの
    - サーバーやネットワーク機器、OS
  - ユーザーが直接行うもの
    - ミドルウエアや開発環境、アプリケーションの実装

- PaaS（Platform as a Service）

  - 事業者が提供するもの
    - サーバーやネットワーク機器、OS、ミドルウェア、アプリケーションの開発環境
  - ユーザが直接行うもの
    - アプリケーションの実装

- SaaS（Software as a Service）

  - 事業者が提供するもの
    - アプリケーション
  - ユーザーが直接行うもの
    - アプリケーションとその機能の利用と設定

- クラウドネイティブ
  - クラウド環境でシステムを開発して、そのまま運用する形態

### クラウドの 2 つの潮流

- クラウドといえばパブリック

  - 一般的にクラウドサービスを指すものは、**パブリッククラウド**
  - クラウド事業者のデータセンター内のサーバー群の中でユーザーが物理的に利用しているサーバーは必ず存在する
  - しかし、ユーザーからは自分が利用しているサーバーがどこにあるかがわからない
  - コストメリットの高さや最新技術の利用では優れている
  - 利用に際しては、どの地域（リージョン）、場所（アベイラビリティゾーン）のサーバーを使うかなどは利用者が決める
  - 不特定多数のユーザー向けや変更が多いシステムでよく使われる

- プライベートクラウドと Web システム
  - 自社のためにクラウドサービスを提供する、あるいはデータセンターなどに自社のためのクラウドのスペースを構築するのが **プライベートクラウド**
  - 社内や取引先などを含む特定ユーザー向けの Web システムであれば、プライベートでの提供が増えていく

### 仮想のプライベートクラウド

- プライベートクラウドをパブリック上で実現する

  - プライベートクラウドをパブリック上で実現するサービス**VPC（Virtual Private Cloud）**
  - 自社で保有・管理しているデータセンターは物理的な事業所
  - VPC で実現するプライベートクラウドのセンターはバーチャルなデータセンター
  - 複数のクラウド化できるシステムや Web システムなどをまとめて運用・管理したい場合に使われる

- Web システムの置き場所
  - VPC のネットワークと自社のネットワークは、VPN や専用線などで接続される
  - VPC 内の仮想サーバーやネットワーク機器には、プライベートな IP アドレスを割り当てることができる
    - 自社の拠点間でサーバーなどの IP アドレスを指定してアクセスするのと同じように接続できる

### クラウド事業者の概要

- クラウド事業者の選定
  - これからクラウドに関する知見を高めたい場合のおすすめ
    - AWS、Azure
    - OSS のクラウド基盤となる OpenStack

### データセンターとクラウド

- データセンターとは？

  - クラウドを支えるファシリティの基盤

- データセンターが提供する 3 タイプのサービス

  - ホスティング
    - データセンターのファシリティ（建物、関連設備）の保有とともに ICT の運用、ICT リソースも保有して提供し、ユーザーはソフトウェアをどうするかに集中できる
  - ハウジング
    - ICT 機器などのリソースはユーザーが保有していて、運用の監視などはセンター側で行う
  - コロケーション
    - データセンターはファシリティの提供にとどまる

- クラウドはホスティングに当たる

  - ISP のレンタルサーバーもホスティング

- ハウジングやコロケーションはネットワーク接続の利便性、堅牢なファシリティ利用などのニーズで利用される

### 既存システムをクラウド化するには？

- 2 段階の移行作業
  - システムを別の環境に移行することをマイグレーションという
  - 仮想環境でないシステムをクラウド環境に移行するには大きく 2 つの段階がある
    - サーバーの仮想化
    - クラウド環境への移行

---

## Web サイトの開設に際して

### データベースを使うか否か

- Web サイトと Web アプリの見極め

  - 目指すサイトがどのようなレベルか事前に理解する
    - 開設するサイトが Web サイトのみにとどまるのか
    - Web アプリにまでなるのか
    - **DB の必要性**で見極める
  - 会員管理、商品販売、サービスの予約や取引などがあるかどうか
    - この場合、DB が要る
  - おすすめの商品の紹介や投稿記事を提供して顧客の関心を高めるなどであれば、静的なページの集合体で足りる

- Web アプリと Web システムの見極め
  - Web アプリからさらに複雑な処理や規模が大きくなると、Web システムのレベルになる
  - **多機能になる**、**他のシステムとのデータの連携**
    - 決済代行会社とシステムを接続して多様な決済手段に対応する
    - 位置や天気などの外部からの情報と連携したサービスを提供する
    - Web でビジネスをしたい企業や個人にサービスとしてしくみを提供する
    - IoT デバイスなどから定期的にデータがアップロードされる

### ターゲットは誰か？

- 誰に向けた Web サイトか？
  - ビジネスか否かなどの利用シーンと、Web サイトやシステムをイメージすると同時に**誰のための、誰に利用してもらうサイトやシステムなのか**も重要
  - ビジネスや情報発信の開始に際して、企画者の頭の中に想定ができていれば進みは早い
  - 誰に向けてかが定まらないと、Web サイトのデザインと操作方法が決められなくなる
    - 若者向けだと、多少操作が変わってもなんとかなるが、年齢層が高いと、統一感やプロセスがしっかりとしたうえでわかりやすい操作が求められる
  - **ペルソナ**
    - ターゲット層の中でも具体的な人材や架空のユーザーを定めて、それに基づいてサイトのデザインや操作の設計をすることが増える

### サイト開設の準備

- Web サイトの構築と運営の準備

  - ビジネスや Web システムの概要、ユーザー像が見えていれば、Web サイト開設に向けて進める
  - そのためにサイト構築に関わる作業と開設後の運用が必要
  - Web サイトの構築時に検討しておく必要があるもの
    - Web サイトが立ち上がる時点のコンテンツ制作
    - サイトデザイン
    - システムの開発やサービスの選定
    - 稼働後の管理

- 稼働後に加わる要素
  - システムの修正と変更
  - コンテンツの維持・管理と新たなコンテンツの追加
  - アクセス解析
  - システムの運用・監視

|                              |                   開設に向けての準備・立ち上げ                   |                                       稼働後                                        |
| :--------------------------: | :--------------------------------------------------------------: | :---------------------------------------------------------------------------------: |
|        コンテンツ制作        |                     立ち上げときのコンテンツ                     | 稼働後の追加、既存コンテンっつの更新や削除<br>アクセス解析や SEO 対策の影響も受ける |
|        サイトデザイン        |                 トップページを初めとするデザイン                 |   トップ画像の入れ替え、リニューアルなど<br>アクセス解析や SEO 対策の影響も受ける   |
| システム開発<br>サービス選定 |              Web アプリやシステムなどに合わせた開発              |                                   主に変更や追加                                    |
|           SEO 対策           |               検索エンジンに対応した検索キーの設定               |      アクセス解析や想定をもとに、検索キーの設定・変更、リンクの設定などを行う       |
|         アクセス解析         |      立ち上げ時点では、解析の方法、ツールの選定などを決める      |            定期間隔で解析を行い、サイトの利用目的に応じた変更をうながす             |
|     システム運用<br>監視     | 立ち上げ時点では、運用や監視の進め方、ツールの選定などにとどまる |         稼働状況の把握、定期バックアップなど<br>基本的には自動化されている          |

### ドメインの取得

- レジストラーとレジストリ
  - Web サーバーやインターネット環境を提供してくれる ISP やクラウドなどの事業者に申請する
  - インターネットは自由な世界ではあるものの一方で公共性などもあるので、ドメイン名に関してはさまざまな機関が手を携えて管理されている
  - ドメイン申請の受付をする事業者は、**レジストラー（ICANN 認定レジストラ）**
  - 受け付けた申請データをもとにドメインの登録をする管理事業者は、**レジストリ**

[ドメイン名の登録 - JPNIC](https://www.nic.ad.jp/ja/dom/registration.html)

### 個人情報保護への取り組み

- Web サイトに必須のメニュー

  - ビジネスをしている Web サイトであれば、個人情報を守る必要がある
    - 個人情報とは、氏名、その他の記述で個人が特定できる情報
    - 2017 年に改正された**個人情報保護法**の施行から、個人情報を扱うすべての企業ならびに個人が守るべきルール
  - 個人情報を扱う Web サイトでは、「個人情報保護法」、「プライバシーポリシー」などのページで、考え方や具体的な対策を示して同意を得ることが必須
  - **GDPR（General Data Protection Regulation：EU の一般データ保護規則）**

- オンライン販売に必要な表示
  - オンライン販売の場合、**特定商取引法**の表記が必要

### https 接続を支援する機能

- Web サイト全体を https で表示する
  - https へのリダイレクトのために必要な作業
    - SSL 証明書の購入や設定
    - ポート 80(http)でのアクセスをポート 443(https)に切り替える

### スマートフォンと PC の両方に対応する

- 縮尺か異なるデザインか？

  - デザインが変わらないタイプ（端末の大小にかかわらず同じように見せる）
    - 基本は PC 画面に合わせる
  - デザインが変わるタイプ（端末の大小で見え方が異なる）
    - 端末の大きさでデザインが変わる

- 画面サイズとブレークポイント
  - 端末の画面サイズ（横幅）を取得して判別して、画面サイズように CSS を分岐する
  - デザインが変わるのがレスポンシブデザイン
  - 分岐する画面サイズは、**ブレイクポイント**で決める

### カバーするデバイスへの対応

- HTML と CSS の中で、メディアタイプとしてデバイスを指定できる
  - [使えるメディアタイプ](https://developer.mozilla.org/ja/docs/Web/CSS/Media_Queries/Using_media_queries#media_types)

### コピーカードは必要か？

- 一般的なコピー防止の対策

  - JavaScript で `docuument.contextmenu` を false で返す
  - html の属性に `oncontextmenu` を false で返す

- 仕方ないことを前提とした対策
  - コピーされることは仕方ないこととして画像そのものに対策を施す考え方
    - コピーされても許容できるレベルにまで画質を落とす
    - コピーできそうな画像にはすべて透かしを入れる

### 管理者として Web サーバーに接続する方法

- 外部から Web サーバーに接続する方法
  - HTTP（HTTPS）接続
    - ユーザーの立場で Web サイトを確認する
  - FTP 接続
    - FTP ソフトを利用して接続
    - 主に、コンテンツの追加や変更を目的とする
  - SSH（Secure SHell）接続
    - SSH ソフトを利用して、接続する端末や IP アドレスを特定するとともに、キーファイルを交換してセキュアな接続を行う
    - サーバーの内部の入れ替えなどもできる

---

## Web システムの開発

### アプリケーションの設計の考え方

- Web アプリにおける設計の考え方のモデル

  - MVC モデル
    - Model
      - コントローラーからの命令を受けて、DB や関連するファイルとのデータの受け渡しや処理を担当する
    - View
      - 処理結果を受けての描画表示を担当する
    - Controller
      - ブラウザからのリクエストを受けてレスポンスを返すまでを制御する
  - 他にも、MVP、MVM などのフレームワークがある

- 3 層構造での位置づけ
  - 3 層構造
    - Web サーバー、アプリケーション・サーバー、DB サーバーから構成される
  - MVC モデルは、基本的にアプリケーションサーバーの機能に入る

### Web システムで使われるデータの形式

- XML（Extensible Markup Language）

  - マークアップ言語
  - 開発者の目的に応じた定義ができるようになっている
  - 汎用性が高い
  - さまざまなシステム間のデータの受け渡しに利用されることが多い

- JSON（JavaScript Object Notation）
  - CSV と XML の中間に当たる形式
  - JavaScript を利用する Web API のデータの受け渡しなどで利用されることが多い
  - フロントエンドとバックエンドのやり取りを HTML ではなく、データのう受け渡しで済ませる際にも使われる

### サーバーの機能を分ける取り組み

- サーバーやシステムを連携して利用する

  - **マッシュアップ**
    - クライアント側で処理を実行して、複数の Web サービス（Web システム）を組み合わせて 1 つに見せる技術
    - 1 つのサービスやシステムですべてを処理する必要がなくなる
  - すでに動いているサービスを連携してつかていくのも 1 つの考え方
    - 他のサーバーやクライアント側にも分担してもらう
  - 複数並んでいるサーバー、サービス、システムの効率的な利用

- ユーザーの知覚にサーバーを置く取り組み
  - **エッジコンピューティング**
    - ユーザーの近くにサーバーの機能やアプリケーションの一部を持ってくる取り組み
  - 近いもので済む処理は近い方で実行する

### 決済処理に見る外部接続の方式例

- リンク方式（CGI など）
- API（データ転送）方式（専用プログラム）
- トークン方式（スクリプトなど）

### サーバーの仮想化技術

- ハイパーバイザー型

  - 物理サーバー上での仮想化ソフトとして、その上に Linux や Windows などのゲスト OS を載せて動かす
  - ホスト OS の影響を受けないように動作するので、複数の仮想サーバーを効率的に稼働させられる
  - OS と仮想化ソフトがほぼ一体なので、完全な仮想環境を提供する
  - 障害発生の際に仮想ソフトか OS かの切り分けが難しい
  - 現在、多数派

- ホスト OS 型

  - 仮想サーバーから物理サーバーにアクセスする際はホスト OS を経由するので、速度の低下などが起きやすい
  - 障害発生の際の切り分けはハイパーバイザー型よりしやすい
  - 伝統的なミッションクリティカルなシステムなそでは根強い人気がある

- コンテナー型
  - Docker
  - ゲスト OS がホスト OS のカーネル機能を共用することで軽量化する
  - コンテナー内のゲスト OS には必要裁定げ園のライブラリしか含まない
    - CPU やメモリへの負荷が小さく、高速な処理が実現できる
    - アプリケーションの起動がスムーズになり、リソース効率がよくなる
  - **仮想サーバーのパッケージを小さく軽量化できる**
  - コンテナー単位で別サーバーに移行できる

### Web サーバーの負荷の実測

- 負荷テストツールによるテスト
- CPU とメモリの利用状況のモニター
  - `dstat` コマンドで CPU とメモリなどの負荷表示

### 仮想サーバーの性能見積もり

- 性能見積もりの例
  - 机上計算による積み上げ
    - ユーザー要求をもとに必要な CPU 性能などを積み上げて算出する
  - 事例やメーカーの推奨
    - 同種の事例やソフトウェアメーカーの推奨を参考にして判断する
  - ツールでの検証や実測に基づく見積もり
    - ツールで深谷利用状況を測定して実測値をもとに算出する
  - 性能見積もりでは、基準値をベースに算出するのが基本

### データ分析システムの構成例

- データやログの分析
  - アプリケーションのデータやシステムへのアクセスのログなどは、DB や OS の Log に蓄積される
  - 蓄積されたデータを全文検索アプリの `Elasticsearch` で解析して、その結果をビジュアル化してくれる `Kibana` で表示する
  - Web 環境で大量のデータを分析して表示してくれるしくみ

---

## セキュリティと運用

### 脅威に応じたセキュリティ対策

- 不正アクセスへの対策
  - 情報システムで一般的に取られているセキュリティ上の脅威のメインは、不正アクセス
  - データの漏洩、ユーザーへのなりすまし、ビジネスへの実害の恐れ

|    セキュリティ脅威    |                             対策例                              |
| :--------------------: | :-------------------------------------------------------------: |
| 外部からの不正アクセス | ファイアウォール<br>緩衝地帯（DMZ）<br>サーバー間っ通信の暗号化 |
| 内部からの不正アクセス |    ユーザー管理<br>アクセスログの確認<br>デバイス操作の監視     |

- 悪意ある攻撃
  - 迷惑メールや怪しい添付メールの送信
  - 大量のデータ送信によるサーバーのダウンを狙う
  - なりすましなどの標的型攻撃
  - OS などの脆弱性を突く攻撃

### セキュリティ対策の物理的な構造

- ファイアウォールと緩衝地帯

  - ファイアウォールと内部のネットワークの間に緩衝地帯（DMZ）が設けられている

- 機能分けされた防御の方法
  - 緩衝地帯のように階層構造に機能分けして防御することを**多層防御**

### 緩衝地帯での守り方

- セキュリティ専用のネットワーク

  - ファイアウォールと内部のネットワークの間にある緩衝地帯
  - 緩衝地帯は、セキュリティシステム専用のネットワーク
  - 入り口のところに、セキュリティ対策機能を持ったサーバーやネットワーク機器を設置する
  - セキュリティ機能専用のハードウェアを 1 つにまとめる方法　 → 　 UTM（Unified Threat Management）

- 侵入を検知して防止するシステム
  - 侵入検知システム（IDS：Intrusion Detection System）
  - 侵入防止システム（IPS：Intrusion Prevention System）

### 緩衝地帯を抜けた先の守り

- IDS/IPS を抜けた通信への対応

  - DoS（Denial of Service）攻撃のような短時間にサーバーが処理できないような大量のアクセスなどは防ぐことができる
  - 悪意のあるデータなどが含まれていても、見た目は正常に見える通信は通過することができる
  - WAF（Web Application Firewall）
    - 通信内容を見て悪意のあるデータの有無を確認するしくみ

- ログの分析と結果を反映するシステムが最重要
  - 過去の不正や悪意のある通信のログの蓄積と分析が重要

### お客様を守るしくみ

- 企業システムの本人確認

  - 多要素認証（Multi-Factor Authentication：MFA）
    - IC カード、生体認証、業務用 PC 以外の端末なども利用した厳格化

- なりすましやパスワードの取得などへの対策
  - パスワードクラッキング
    - ID を取得した第三者が、プログラムでパスワードを次々と試して当てることで本人へのなりすましを図る対策として CAPTCHA
    - **CAPTCHA（Completely Automated Public Turing Test To Tell Computers and Humans Apart）**
  - セッションハイジャック
    - Session と Cookie などを何らかの方法で取得される脅威
    - 異なる端末や IP アドレスからのアクセスであれば直ちに遮断する

### 内部のセキュリティ対策

- 内部の不正アクセスへの対策
  - Web サービスやシステムを提供する側の内部からの不正アクセスへの対策があってはじめて機能する
  - アクセスと利用制限
    - 認証機能
      - ユーザー名、パスワード、証明書、生体含む多要素認証
    - 利用制限
      - 管理者、開発者、メンバーなどの権限を設定したロールを提供し、業務要件に基づいて割り当てる（ロールベースアクセス制御）
  - データ秘匿
    - 伝送データの暗号化
      - VPN、SSL など
    - 保管データの暗号化
      - ストレージ書き込み時に暗号化するなど
    - 不正追跡・監視
      - 不審者による利用の追跡ならびに監視を行う

### 稼働後の管理

- 運用管理

  - 運用監視：Zabbix、Hinemos など
  - 性能管理
  - 変更対応
  - 障害対応
  - 定型的、マニュアル化できている運用など

- システム保守
  - 性能管理
  - レベルアップ
  - 機能追加
  - バグ対応
  - 障害対応
  - 主に、非定型、マニュアル化ができていない運用など

### 障害に対応するしくみ

- 本番系と待機系

  - 障害が発生しても稼働し続けるシステム**フォルトトレランスシステム（Fault Tolerance System）**
  - サーバーを本番系（アクティブ）、待機系（スタンバイ）にわける
    - 動いている機器と何かあったときのために待機している機器を用意する**冗長化**
    - 複数の機器で負荷を分散させる考え方

- クラスタリングの概要
  - **クラスタリング**
    - ユーザーから本番系・待機系が 1 つのシステムとして見えるようにすること
  - ホットスタンバイ
    - 本番系と待機系を準備してシステムの信頼性を向上させる方法
    - 本番系のデータを常時待機系にコピーして、障害発生時にすぐに切り替わる
  - コールドスタンバイ
    - 本番系と待機系を準備する
    - 本番系に障害が発生してから待機系を起動させるため、交代に時間がかかる
  - 自動フェイルオーバー（Failover）
    - 自動で再起動して待機系に切り替えるしくみ
