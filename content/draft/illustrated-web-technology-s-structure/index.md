# Web技術のしくみ

- Web技術に関する基本的な地磁気を身に着けたい
- WebサイトやWebアプリケーションなどを始めたいと考えている
- クラウドも含めて用語や技術、動向などを確認したい
- Webを活用したビジネスを検討している

## Web技術の基本

### Webシステムの構造

- デバイス（ブラウザ）、インターネット、Webサーバーが基本の構成

- Webサイト
  - 文書情報を中心としたWebページで構成される集合体
- Webアプリ
  - 動的なしくみを指す
  - Webサーバーに加えて、アプリケーションサーバー（APIサーバー）、データベースサーバー（DBサーバー）などが加わる
- Webシステム
  - webサイトとWebアプリに加えて、APIなどで個別のサービスを提供するなど、やや複雑で規模の大きい仕組み
  - 外部システムとの連携、自動での情報取得、IoTデバイスの利用など

### Webページを閲覧する

- ユーザーに向けた専用アプリの存在
  - アプリを立ち上げるとすぐにURLからアクセスできるようになっている
  - 別のサーバーなどと自動的に特定のデータをやりとりするような使い方もできるようになっている

### URLとは?

- スキーム名、FQDN（Fully Qualified Domain Name）（ホスト名とドメイン名の組み合わせ）、パス名で表す
  - スキーム名　：　https://
  - FQDN　：　www.example.com
  - パス名　：　/about

- ドメイン名とは？
  - インターネットの世界の中で一意の名前
  - 対になるグローバルIPアドレスを持っている

- 主なドメイン名
  - ドメイン名は、主に[gTLD](https://www.nic.ad.jp/ja/basics/terms/gtld.html)と国ごとに割り当てられた[cc(country code)TLD]](https://www.nic.ad.jp/ja/basics/terms/ccTLD.html)などがある
  - gTLDの例
    - .com　：　誰もが登録できる商業組織向け
    - .net　：　誰もが登録できるネットワーク用
    - .org　：　団体、協会などの法人で使われることが多い
    - .edu .gov　：　教育や政府機関など組織としての要件が必要
    - .boz .info .name .pro　：　誰でも登録できるビジネス用、個人用、士業向けなどの特性がある
  - JPドメインのccTLDの例
    - .co.jp　：　会社法人のスタンダード
    - .or.jp .ac.jp .go.jp　：　財団、社団、学校法人、政府機関

### Webサーバーの外見と中身

- Linuxが増えている理由
  - Windows serverには多くの機能が実装されていて、必要な機能を比較的簡単に設定できるが、メンテナンスを含めてそれなりの費用がかかることがある
  - Linuxの場合、Windowsより少しむずかしくなるが、必要な機能だけを追加していくので、ディスクの節約や安定性の向上に加えて、コストも安価に抑えられる

### ブラウザとは別の存在

- APIとは?
  - 異なるソフトウェアがやりとりをする際のインタフェースの仕様を意味する言葉

### webサイトの規模

- Webサイトの規模を測る数値として総ページがある
  - 小規模　：　100ページ以内
  - 中規模　：　100~1000ページ以下
  - 大規模　：　1000ページを超える
  - 超大規模　：　10000ページを超える

- ページ数のカウントの例
  - Googleの `site:` コマンド
  - `site:example.com`

---

## Web独自のしくみ

### Web技術の移り変わり

- 広がる利用領域
  - 以前の情報システムは `SoR（System of Record：記録のシステム）` 
    - 利用する組織での管理を中心としていた
  - 現在は、 `SoE(System of Engagement：つながるシステム)`
    - さまざまな組織や個人のつながりも視野に入れたシステムを目指す取り組みが増えている
  - 閲覧中心であったWebサイトから、さまざまな情報を収集して活用するWebアプリやシステムへの変化

- 変わる開発スタイル
  - 独自性や専用性を重視するしくみから、汎用性や可用性を習字する仕組みに変化
  - ゼロベースで開発する時代から、開発基盤やフレームワークを利用する、さらに、すでに存在するサービスやAPIも利用する
  - プログラミングにこだわらず、コードをできるだけ書かないローコードやノンコードによる開発のスタイル
  - 情報をっ活用することを目指すと、さまざまな情報やシステムとのつながりが重視され、それらの実現がさらなるつながりを生み出す好循環となって市場は拡大していく

### Webサイトの表と裏

- 見た目が重要なシステム
  - ユーザーが得られる満足する体験を設計するUXデザインを目指すことが多い
  - デザインや画面の動線が重要視されるようになり、見た目が重要になってきている
  - web開発では見た目と機能を両輪として進めていく特徴がある
  - 業務システムでは、設計通りの機能の実現が重視される

### 変化しないページと変化するページ

- 静的ページと動的ページ
  - 静的ページ
    - 記述された文書の表示が主体となる固定的な動きのないページ
  - 動的ページ
    - ユーザーからの入力やユーザーの状況に応じて、出力する内容が動的に変化するWebページ

- 動的ページの例
  - 検索エンジン、掲示板、SNS、アンケート、オンラインショッピング

### Webサイトの裏側

- HTTPリクエスト
  - HTTPでは、一意のURLを相手として指定して通信する
  - 1回ごとに相手とのやり取りを完結させる `ステートレス` という特徴がある
  - HTTPメッセージの中で、HTTPリクエストとレスポンスが実行される
    - これが、1対1の関係でステートレス性が担保される
  - HTTPリクエストに使うHTTPメソッド
    - GET、POST、PUT、CONNECTなどがある
  - ブラウザからWebサーバーにどのようなリクエストを送るのか
    - HTTPプロトコール > HTTPメッセージ > HTTPリクエスト > GET、POSTのようなHTTPメソッド

- HTTPレスポンス
  - リクエストを送った相手側のWebサーバーの情報や、リクエストがどのように処理されたかどうかを示すステータスコードが含まれる

### プログラムの起動

- 動的ページでは、 `データの入力 > 処理の実行 > 結果の出力・表示` となる
  - これらの一連のプロセスのゲートウェイでもあり、トリガーとなる仕組みは、CGI(Common Gateway Interface)と呼ばれる
  - ブラウザ側で入力されたデータを送る際に、WebサーバーにあるCGIプログラムを同時に呼び出す
    - HTMLファイルなどに起動するCGIのファイル名をあらかじめ入れておく
    - CGIプログラムが起点となって処理を実行し、結果の出力も行う

- CGIの使われ方
  - 静的ページが多数はだった時代に、動的なページを実現するための取り組みの中で生まれてきたしくみ
  - しかし、CGIでは1回1回別のプログラムの起動やファイルのオープンやクローズなどを必要とするため、多数のユーザーを相手にする大規模なWebサイトの処理には向かないこともある

### 再接続を支援するしくみ

- Cookie
  - Webサーバーがブラウザに対するHTTPレスポンスの中にCookieを含めて送信する
  - ブラウザがCookieを送ってきたWebサーバーに再びアクセスすると、WebサーバーはそのCookieを読み取って、一見（いちげん）のユーザーとは異なる対応をする
  - 利用に際しては、ブラウザ側でCookieを含めたやり取りを許容する設定をする必要がある
  - 2020年6月に成立した改正個人情報保護法では、企業が個人とCookie情報をあわせて利用する場合には個人の同意を得ることが義務付けられている

### 一連の処理の開始から終了までの管理

- Session
  - Session自体は、端的には処理の開始から終了までを意味する
  - サーバーやWebアプリ側で管理する
  - 複数のWebページやアプリケーションを連携するためにサーバーに情報を保存してブラウザとやり取りをするしくみ
  - Cookieの中に、一連の処理を表す一意のSessionIDを含める形で、ブラウザとサーバーのやり取りが進められていく

- Sessionを一意に表すID
  - ブラウザからのアクセスが会った際に、サーバー側でSessionスタートを宣言することからはじまる
  - SessionIDはCookieをっ通じてやり取りするが、万が一、別のユーザーにSessionIDを取られても問題が発生しないように、意味を持たない英数字の羅列などで生成される
  - SessionIDとユーザーの状況などはサーバー側で紐付ける
  - Sessionの管理自体はパターン化された処理でもあるため、実際の開発ではフレームワークを利用することが多い

---

## Webを支えるしくみ

### Web全体を支えるしくみ

- サーバーの種類
  - Webサーバー
  - FTPサーバー
  - DNSサーバー
  - Proxyサーバー
  - SSLサーバー
  - SMTPサーバー
  - POP3サーバー
  - などなど

- Webサーバーまでの道
  - ユーザーのPCからはDNSやProxyサーバーなどのしくみを経由して、求めるWebサーバーのネットワークにいく

### IPアドレスとMACアドレス

- IPアドレス
  - インターネット上で、デバイスとWebサーバーなどのコンピューター同士がお互いにIPアドレスで呼びかける
  - コンピューターのソフトウェアが認識するネットワーク上の住所
  - **ネットワークで通信相手を識別するための番号**
  - IPv4では、2の32乗（約43億）のIPアドレスが利用できる
  - IPv6では、2の128乗（約340潤）のIPアドレスが利用できる
  - IoTシステムの導入が進んで、各種センサーやデバイスのインターネット接続が進むようになると、IPv4ではIPアドレスが枯渇して、IPv6への切り替えが進む

- MACアドレス
  - 各デバイスが持っているハードウェアが認識する住所
  - **ネットワーク内での機器を特定するための番号**
  - 接続したいコンピューターのIPアドレスを指定して進んでいく
    - アプリケーションがIPアドレスを指定して、OS内のIPアドレス帳をもとにMACアドレスを確認する
    - アドレス帳で探せなかったら、ローカルネットワークでつながっているコンピューターに対して対象のIPをもつMACアドレスがないか呼びかける
    - IPが存在したら、そのコンピューターのMACアドレスをOS内のIPアドレス帳に記録し、IPアドレスを返す
    - それでもIPが存在しなかったら、他のネットワークあるいはインターネットの世界にも呼びかける

### IPアドレスを付与する

- DHCPの概要
  - 通信するための相手のIPアドレスが分かっているとしても、相手から見たときの自分のIPアドレスが必要になる
  - DHCP（Dynamic Host Configuration Protocol）がその役割を担う

- IP割り当ての流れ
  - 企業内のネットワークで新たなコンピューターを接続する際に、IPアドレスを追加で付与する必要がある
  - ネットワークへ新たに接続されたクライアントPCでは、サーバーのOSに存在するDHCPサービスへアクセスして自身のIPアドレスやDNSサーバーのIPアドレスなどを取得する
  - DHCP側では、新たに接続されたクライアントPCに対して、定められた範囲の中から使われていないIPアドレスを付与する

- IPアドレスの動的な割り当て
  - 企業内のサーバーやネットワーク機器などでは重要な存在で役割も変わらないことから、固定のIPアドレスを付与する
  - クライアントPCはDHCPによる動的な割り当てが一般的
  - 割り当てられた日時が異なると端末が同じでもIPアドレスが異なることがある
  - IPアドレスの割り当てに際しては、合言葉のように「DHCPxx」をつけてやりとりをする

### ドメインとIPアドレスをつなぐ

- DNS（Domain Name System）
  - ドメイン名とIPアドレスを紐付けてくれる機能
  - ブラウザで入力されたドメイン名をIPアドレスに変換する
  - メールアドレスの@以降にあるドメイン名をIPアドレスに変換する

- DNSの存在
  - ユーザー数やネットワークシステムの規模に応じて存在そのものが変わる
  - DNSキャッシュサーバーとDNSコンテンツサーバーがある
  - メールやWebサーバーにDNS機能が存在するケース（外部のDNSサーバーを利用）
  - DNSの多重化

### インターネットの通信の代行

- インターネット通信の代理と効率化
  - ユーザーが企業の内部からWebサーバーにアクセスするケース、個人がISPを通じてWebサイトにアクセスするケースでは、端末のIPアドレスが表に出ることはない
  - この場合、Proxyサーバーが各クライアントからするとインターネット通信の代行をする
    - 内部のネットワークとインターネットの間でアクセスの中継をしている
  - 同じサイトへのアクセスのリクエストがある場合、1台目のProxyのキャッシュで対応して、2台目以降は効率化を図る

- Proxyの役割
  - ファイアウォールとしての役割
    - Webサイトによって閲覧できなくする/禁止マークが表示する
    - 外部からの適切ではないアクセスに対してクライアントを守るようにブロックする
  - アクセスしたユーザーが誰なのかわからないようにする
    - 同じ企業やネットワークなどから多数のアクセスがあっても、同じIPアドレスにしか見えず、分析が限定されることがあり得る

### ブラウザとWebサーバー間の暗号化

- 通信の暗号化
  - SSL（Secure Sockets Layer）
  - インターネット上の通人を暗号化して、**悪意のある第三者からの盗聴や改ざん等を防ぐ**ことを目的とする

- SSLの流れ
  - SSLでの通信を行うことをサーバーとクライアントの両者で確認することからはじめる
  - 確認後、サーバーから証明書と暗号化に必要な鍵を送って、通信する二者に固有の暗号と複合の準備ができたら、データの通信が進められる
  - とくにユーザー側で意識することはない

### Webサーバーを構築する方法

- レンタルサーバー
  - 独自のドメイン名を取得して、そのままISPが提供するWebサーバーをレンタルする
  - もっとも噛んったんで迅速な方法
  - ユーザーがすぐに使える状態で提供される

- クラウドサービス
  - サーバーやネットワーク機器などを自社で持たない
  - サーバーの構成、ソフトウェアのインストールや設定などの作業は自ら実施

- 自社の施設内での構築
  - IT機器、ソフトウェアのメンテナンスにコストを要する

||レンタルサーバー|クラウドサービス|自社内で構築|
|:---:|:---:|:---:|:---:|
|選定の基準|ディスク容量<br>DBへの同時アクセス数<br>SSLその他の有無などで価格が決まる|CPUとメモリでサーバーを選定<br>ディスクも選定<br>その他は細かいメニューから付け足していく|性能見積もりをしてサーバーを選定<br>ディスクも選定<br>必要なソフトウェアをインストール<br>環境構築や設定を自ら、あるいは委託した企業に任せる<br>自らメンテナンスをする必要がある|
|代表的な事業者|GMO、エックス、さくらインターネットなど|AWS、GCP、Azure、富士通、IBM、ニフクラ、BIGLOBEなど|ITベンダーとの取引で購入|
|その他|年額で2万円前後<br>各社ともクラウドサービスと称しているが、以前からのISPのサービスを原則としている|無償利用機関のあることが多い<br>料金はレンタルサーバーより高くなる<br>自ら設定は行うが、細かい機能設定が可能|コストはもっともかかる<br>スキルがないと実現できないが、自らの好きなようにできる|

- 使い方の例
  - Webサーバーやメールサーバーなどに限定するのであれば、レンタルサーバー
  - 他のシステムも含めてクラウド化をすすめるのであればクラウドサービス

### Webサーバーを立てる

- Webサーバーを立てる手順の概要
  - すでにネットワークが存在していて、セキュリティ対策が講じられている場合、大まかな手順は以下
    - OSの最新化
      ```
        sudo yum update
      ```
    - Webサーバー機能のインストール
      ```
        sudo yum install httpd
        sudo systemctl start httpd.service
        sudo systemctl enable httpd.service
      ```
    - ネットワーク設定
  - `systemctl` はサービス管理を意味する
  - FTPの機能が必要な場合、 `sudo yum install vsftpd` などでインストールして起動する
  - 自らサーバーを立てるとき、必要な作業

- LinuxのWebサーバーのお約束ごと
  - Webサーバーの特定のディレクトリなどに書き込みができる権限（パーミッション）の設定をする必要がある
    - `chmod` はアクセス権（パーミッション）の設定・変更のコマンド
    - `775` は、所有者と特定のグループがファイルやディレクトリの**読み取り**、**書き込み**、**実行**のすべての権限を持つが、その他の利用者は、**読み取り**、**実行**のみに制限される
  - 使用するサーバーの種類に応じて、 `var/www/html` のようなディレクトリ配下にhtmlなどのファイルをアップロードする必要がある

### Webサーバーを作る

- Webサーバー稼働までの工程
  1. アカウントの作成
  2. サーバーの作成
    2-1. CPUとメモリなどでリストから選ぶ
    2-2. ディスク容量を決める
  3. 作成したtサーバーへのセキュアな接続の準備
    3-1. 管理者などとして特定した端末でSSH接続
    3-2. 認証用の特別なファイルを作成
    3-3. ファイアウォールの設定
  4. OSの最適化とApacheのようなWebサーバー機能のインストール
  5. HTTPプロトコルでサーバーへ接続できるようにする
    5-1. 一般ユーザーがWebサイトを見られるようにする
  6. 固定のIPアドレスの割り当てとサーバーへの紐付け
    6-1. 固定のIPアドレスを取得して、サーバーに紐付ける
    6-2. ドメイン名とIPアドレスの紐付けをする
  7. コンテンツのアップロード
    7-1. パーミッションの設定やコンテンツのアップロードで閲覧可能にする
- 1と2がもっとも気を使う作業
  - オンラインマニュアルなどに事前に目を通してから作業する、各工程でミスしないことが重要なので、工程ごとにスケジュールを組んで計画的に行う

---

## Webの普及と広がり

### SNSの裏側

- 管理者と開発者の視点で見る
  - インスタグラムのインサイト
    - いいねの数、プロフィールへのアクセス数、投稿を見たアカウント数などが閲覧できる

---

## Webと異なるシステム

### Webにできないシステム

- Webと異なるシステム
  - 主に、インターネットを利用しないシステムについて

- Web化しやすいシステム
  - システムの規模にかかわらず、外部ネットワーク接続あり
- Web化しにくいシステム
  - 内部ネットワークにクローズしたケース

- 小規模なオンプレミスのシステム
  - 小規模でユーザーが限定されている部門内などにおけるオンプレミスのシステム
  - 自社でIT機器との他のIT資産を保有して、自らが管理している敷地内に設置して運用する形態
  - オンプレミスのシステムの中でも、Webに移行しない・できないシステムは外部のネットワークに接続しない形態のもの

- インターネットを利用するシステム
  - さまざまな場所や異なるネットワークから接続できることが大きなメリット

- システムの規模とWeb化に関係はない
  - 外部ネットワークに接続する必要がないというより、内部のネットワークにクローズしたいシステムと言い換えたほうが適切

### 止めることができないシステム

- 交通機関システム
  - 交通機関の運行を管理するシステムは、各社のクローズされた専用のネットワークの中で動いている
  - 管制室に届く駅や電車などからの情報に万一遅延が生じると、全体の運行に支障が出るので、インターネット接続に切り替えることができない
  - 自動改札機とICカードである程度の処理ができる/システムのブロックごとに分業化が進んでいることから、部分的にインターネット通信にできる可能性はある

- 電力会社のシステム
  - インター姉と経由での通信のようなタイムラグや何らかの原因での通信エラーがあると、電力の共有が止まる時間や頻度が増える可能性があり得る
  - 社会基盤インフラに関わるシステムは、24時間365日止めることができないので、**ミッションクリティカルなシステム**と呼ばれる
  - 業務自体やユーザーが許容できるレスポンスタイムが極めて短い

- 銀行取引のシステム
  - 現金の動きがある限りは止めることができないシステム

- クラウド化が進みつつある医療の世界
  - 産業界でのERPに相当する最重要なシステムとして電子カルテシステムがある
  - ミリ秒の世界でのレスポンス要求ではないことやもともと病院が強固な専用ネットワークを保有していないことが背景にある

- Web化への鍵や可否は、**レスポンスタイム**と**独立ネットワークの必要性**にある

### 既存システムのクラウド化の障壁

- 既存システムが仮想サーバーでないとクラウドサービスへの移行で苦労する

- 仮想化のソフトウェア
  - VMWare、Hyper-V、Xen、KVM、Dockerなど

### インターネット以外のネットワーク

- 企業や団体のネットワークの基本
  - 内部のネットワークの基本は**LAN（Local Area Network）**
  - 拠点間は、キャリアが提供する通信網**WAN（Wide Area Network）**
  - LANやWANで構成される企業内ネットワークは**イントラネット**
  - 従業員などによる外部からの接続は**VPN（Virtual Private Network）**

- LANが残る理由
  - データ通信の品質、セキュリティの観点で使われる

### サーバーの機能の違い

- オフィスで一般的なファイルサーバー
  - クライアントPCがWindowsで、サーバーがWindows Serverであれば、「ファイルサーバー」と「ファイルサーバーリソースマネージャー」の追加が必要になる
  - サーバーがLinuxなら、Sambaのインストールや設定が必要になる
  - ネットワークの接続もLANが前提となる

- Webサーバーには内部のシステムは同居しない
  - Webサーバーの機能は、Webサーバーにアップロードされたコンテンツを、インターネット経由で閲覧できるようにする
    - ファイルサーバーと一部近い機能はあるもののまったく異なるシステム
  - 不特定多数の外部の端末から接続を受けることができるWebサーバーの中に、内部のネットワークで共有する各種業務のファイルを置くことや、ファイルサーバーの機能を同居させることは基本的にない

---

## クラウドとの関係

### クラウドの概要と特徴

- クラウドとは？
  - 情報システムならびにサーバーやネットワークなどのIT資産をインターネット経由で利用する形態

- クラウドサービスの特徴
  - 利用に関する特徴
    - 従量課金
    - 利用料の拡大や縮小が用意
  - IT機器やシステムに関する特徴
    - IT機器や関連設備はクラウド事業者が保有
    - 機器や設備などの運用はクラウド事業者が行う
    - セキュリティや多様な通信手段への対応が整備されている
  - 変化が想定される、先の見通しが立てにくいサービスやシステムなどに適している

### クラウドのサービスの分類

- IaaS（Infrastructure as a Service）
  - 事業者が提供するもの
    - サーバーやネットワーク機器、OS
  - ユーザーが直接行うもの
    - ミドルウエアや開発環境、アプリケーションの実装

- PaaS（Platform as a Service）
  - 事業者が提供するもの
    - サーバーやネットワーク機器、OS、ミドルウェア、アプリケーションの開発環境
  - ユーザが直接行うもの
    - アプリケーションの実装

- SaaS（Software as a Service）
  - 事業者が提供するもの
    - アプリケーション
  - ユーザーが直接行うもの
    - アプリケーションとその機能の利用と設定

- クラウドネイティブ
  - クラウド環境でシステムを開発して、そのまま運用する形態

### クラウドの2つの潮流

- クラウドといえばパブリック
  - 一般的にクラウドサービスを指すものは、**パブリッククラウド**
  - クラウド事業者のデータセンター内のサーバー群の中でユーザーが物理的に利用しているサーバーは必ず存在する
  - しかし、ユーザーからは自分が利用しているサーバーがどこにあるかがわからない
  - コストメリットの高さや最新技術の利用では優れている
  - 利用に際しては、どの地域（リージョン）、場所（アベイラビリティゾーン）のサーバーを使うかなどは利用者が決める
  - 不特定多数のユーザー向けや変更が多いシステムでよく使われる

- プライベートクラウドとWebシステム
  - 自社のためにクラウドサービスを提供する、あるいはデータセンターなどに自社のためのクラウドのスペースを構築するのが **プライベートクラウド**
  - 社内や取引先などを含む特定ユーザー向けのWebシステムであれば、プライベートでの提供が増えていく

### 仮想のプライベートクラウド

- プライベートクラウドをパブリック上で実現する
  - プライベートクラウドをパブリック上で実現するサービス**VPC（Virtual Private Cloud）**
  - 自社で保有・管理しているデータセンターは物理的な事業所
  - VPCで実現するプライベートクラウドのセンターはバーチャルなデータセンター
  - 複数のクラウド化できるシステムやWebシステムなどをまとめて運用・管理したい場合に使われる

- Webシステムの置き場所
  - VPCのネットワークと自社のネットワークは、VPNや専用線などで接続される
  - VPC内の仮想サーバーやネットワーク機器には、プライベートなIPアドレスを割り当てることができる
    - 自社の拠点間でサーバーなどのIPアドレスを指定してアクセスするのと同じように接続できる

### クラウド事業者の概要

- クラウド事業者の選定
  - これからクラウドに関する知見を高めたい場合のおすすめ
    - AWS、Azure
    - OSSのクラウド基盤となるOpenStack

### データセンターとクラウド

- データセンターとは？
  - クラウドを支えるファシリティの基盤

- データセンターが提供する3タイプのサービス
  - ホスティング
    - データセンターのファシリティ（建物、関連設備）の保有とともにICTの運用、ICTリソースも保有して提供し、ユーザーはソフトウェアをどうするかに集中できる
  - ハウジング
    - ICT機器などのリソースはユーザーが保有していて、運用の監視などはセンター側で行う
  - コロケーション
    - データセンターはファシリティの提供にとどまる

- クラウドはホスティングに当たる
  - ISPのレンタルサーバーもホスティング

- ハウジングやコロケーションはネットワーク接続の利便性、堅牢なファシリティ利用などのニーズで利用される

### 既存システムをクラウド化するには？

- 2段階の移行作業
  - システムを別の環境に移行することをマイグレーションという
  - 仮想環境でないシステムをクラウド環境に移行するには大きく2つの段階がある
    - サーバーの仮想化
    - クラウド環境への移行

---

## Webサイトの開設に際して

### データベースを使うか否か

- WebサイトとWebアプリの見極め
  - 目指すサイトがどのようなレベルか事前に理解する
    - 開設するサイトがWebサイトのみにとどまるのか
    - Webアプリにまでなるのか
    - **DBの必要性**で見極める
  - 会員管理、商品販売、サービスの予約や取引などがあるかどうか
    - この場合、DBが要る
  - おすすめの商品の紹介や投稿記事を提供して顧客の関心を高めるなどであれば、静的なページの集合体で足りる

- WebアプリとWebシステムの見極め
  - Webアプリからさらに複雑な処理や規模が大きくなると、Webシステムのレベルになる
  - **多機能になる**、**他のシステムとのデータの連携**
    - 決済代行会社とシステムを接続して多様な決済手段に対応する
    - 位置や天気などの外部からの情報と連携したサービスを提供する
    - Webでビジネスをしたい企業や個人にサービスとしてしくみを提供する
    - IoTデバイスなどから定期的にデータがアップロードされる

### ターゲットは誰か？

- 誰に向けたWebサイトか？
  - ビジネスか否かなどの利用シーンと、Webサイトやシステムをイメージすると同時に**誰のための、誰に利用してもらうサイトやシステムなのか**も重要
  - ビジネスや情報発信の開始に際して、企画者の頭の中に想定ができていれば進みは早い
  - 誰に向けてかが定まらないと、Webサイトのデザインと操作方法が決められなくなる
    - 若者向けだと、多少操作が変わってもなんとかなるが、年齢層が高いと、統一感やプロセスがしっかりとしたうえでわかりやすい操作が求められる
  - **ペルソナ**
    - ターゲット層の中でも具体的な人材や架空のユーザーを定めて、それに基づいてサイトのデザインや操作の設計をすることが増える

### サイト開設の準備

- Webサイトの構築と運営の準備
  - ビジネスやWebシステムの概要、ユーザー像が見えていれば、Webサイト開設に向けて進める
  - そのためにサイト構築に関わる作業と開設後の運用が必要
  - Webサイトの構築時に検討しておく必要があるもの
    - Webサイトが立ち上がる時点のコンテンツ制作
    - サイトデザイン
    - システムの開発やサービスの選定
    - 稼働後の管理

- 稼働後に加わる要素
  - システムの修正と変更
  - コンテンツの維持・管理と新たなコンテンツの追加
  - アクセス解析
  - システムの運用・監視

||開設に向けての準備・立ち上げ|稼働後|
|:---:|:---:|:---:|
|コンテンツ制作|立ち上げときのコンテンツ|稼働後の追加、既存コンテンっつの更新や削除<br>アクセス解析やSEO対策の影響も受ける|
|サイトデザイン|トップページを初めとするデザイン|トップ画像の入れ替え、リニューアルなど<br>アクセス解析やSEO対策の影響も受ける|
|システム開発<br>サービス選定|Webアプリやシステムなどに合わせた開発|主に変更や追加|
|SEO対策|検索エンジンに対応した検索キーの設定|アクセス解析や想定をもとに、検索キーの設定・変更、リンクの設定などを行う|
|アクセス解析|立ち上げ時点では、解析の方法、ツールの選定などを決める|定期間隔で解析を行い、サイトの利用目的に応じた変更をうながす|
|システム運用<br>監視|立ち上げ時点では、運用や監視の進め方、ツールの選定などにとどまる|稼働状況の把握、定期バックアップなど<br>基本的には自動化されている|

### ドメインの取得

- レジストラーとレジストリ
  - Webサーバーやインターネット環境を提供してくれるISPやクラウドなどの事業者に申請する
  - インターネットは自由な世界ではあるものの一方で公共性などもあるので、ドメイン名に関してはさまざまな機関が手を携えて管理されている
  - ドメイン申請の受付をする事業者は、**レジストラー（ICANN認定レジストラ）**
  - 受け付けた申請データをもとにドメインの登録をする管理事業者は、**レジストリ**

[ドメイン名の登録 - JPNIC](https://www.nic.ad.jp/ja/dom/registration.html)

### 個人情報保護への取り組み

- Webサイトに必須のメニュー
  - ビジネスをしているWebサイトであれば、個人情報を守る必要がある
    - 個人情報とは、氏名、その他の記述で個人が特定できる情報
    - 2017年に改正された**個人情報保護法**の施行から、個人情報を扱うすべての企業ならびに個人が守るべきルール
  - 個人情報を扱うWebサイトでは、「個人情報保護法」、「プライバシーポリシー」などのページで、考え方や具体的な対策を示して同意を得ることが必須
  - **GDPR（General Data Protection Regulation：EUの一般データ保護規則）**

- オンライン販売に必要な表示
  - オンライン販売の場合、**特定商取引法**の表記が必要

### https接続を支援する機能

- Webサイト全体をhttpsで表示する
  - httpsへのリダイレクトのために必要な作業
    - SSL証明書の購入や設定
    - ポート80(http)でのアクセスをポート443(https)に切り替える

### スマートフォンとPCの両方に対応する

- 縮尺か異なるデザインか？
  - デザインが変わらないタイプ（端末の大小にかかわらず同じように見せる）
    - 基本はPC画面に合わせる
  - デザインが変わるタイプ（端末の大小で見え方が異なる）
    - 端末の大きさでデザインが変わる

- 画面サイズとブレークポイント
  - 端末の画面サイズ（横幅）を取得して判別して、画面サイズようにCSSを分岐する
  - デザインが変わるのがレスポンシブデザイン
  - 分岐する画面サイズは、**ブレイクポイント**で決める

### カバーするデバイスへの対応

- HTMLとCSSの中で、メディアタイプとしてデバイスを指定できる
  - [使えるメディアタイプ](https://developer.mozilla.org/ja/docs/Web/CSS/Media_Queries/Using_media_queries#media_types)

### コピーカードは必要か？

- 一般的なコピー防止の対策
  - JavaScriptで `docuument.contextmenu` をfalseで返す
  - htmlの属性に  `oncontextmenu` をfalseで返す

- 仕方ないことを前提とした対策
  - コピーされることは仕方ないこととして画像そのものに対策を施す考え方
    - コピーされても許容できるレベルにまで画質を落とす
    - コピーできそうな画像にはすべて透かしを入れる

### 管理者としてWebサーバーに接続する方法

- 外部からWebサーバーに接続する方法
  - HTTP（HTTPS）接続
    - ユーザーの立場でWebサイトを確認する
  - FTP接続
    - FTPソフトを利用して接続
    - 主に、コンテンツの追加や変更を目的とする
  - SSH（Secure SHell）接続
    - SSHソフトを利用して、接続する端末やIPアドレスを特定するとともに、キーファイルを交換してセキュアな接続を行う
    - サーバーの内部の入れ替えなどもできる

---

## Webシステムの開発

### アプリケーションの設計の考え方

- Webアプリにおける設計の考え方のモデル
  - MVCモデル
    - Model
      - コントローラーからの命令を受けて、DBや関連するファイルとのデータの受け渡しや処理を担当する
    - View
      - 処理結果を受けての描画表示を担当する
    - Controller
      - ブラウザからのリクエストを受けてレスポンスを返すまでを制御する
  - 他にも、MVP、MVMなどのフレームワークがある

- 3層構造での位置づけ
  - 3層構造
    - Webサーバー、アプリケーション・サーバー、DBサーバーから構成される
  - MVCモデルは、基本的にアプリケーションサーバーの機能に入る

### Webシステムで使われるデータの形式

- XML（Extensible Markup Language）
  - マークアップ言語
  - 開発者の目的に応じた定義ができるようになっている
  - 汎用性が高い
  - さまざまなシステム間のデータの受け渡しに利用されることが多い

- JSON（JavaScript Object Notation）
  - CSVとXMLの中間に当たる形式
  - JavaScriptを利用するWeb APIのデータの受け渡しなどで利用されることが多い
  - フロントエンドとバックエンドのやり取りをHTMLではなく、データのう受け渡しで済ませる際にも使われる

### サーバーの機能を分ける取り組み

- サーバーやシステムを連携して利用する
  - **マッシュアップ**
    - クライアント側で処理を実行して、複数のWebサービス（Webシステム）を組み合わせて1つに見せる技術
    - 1つのサービスやシステムですべてを処理する必要がなくなる
  - すでに動いているサービスを連携してつかていくのも1つの考え方
    - 他のサーバーやクライアント側にも分担してもらう
  - 複数並んでいるサーバー、サービス、システムの効率的な利用

- ユーザーの知覚にサーバーを置く取り組み
  - **エッジコンピューティング**
    - ユーザーの近くにサーバーの機能やアプリケーションの一部を持ってくる取り組み
  - 近いもので済む処理は近い方で実行する

### 決済処理に見る外部接続の方式例

- リンク方式（CGIなど）
- API（データ転送）方式（専用プログラム）
- トークン方式（スクリプトなど）

### サーバーの仮想化技術

- ハイパーバイザー型
  - 物理サーバー上での仮想化ソフトとして、その上にLinuxやWindowsなどのゲストOSを載せて動かす
  - ホストOSの影響を受けないように動作するので、複数の仮想サーバーを効率的に稼働させられる
  - OSと仮想化ソフトがほぼ一体なので、完全な仮想環境を提供する
  - 障害発生の際に仮想ソフトかOSかの切り分けが難しい
  - 現在、多数派

- ホストOS型
  - 仮想サーバーから物理サーバーにアクセスする際はホストOSを経由するので、速度の低下などが起きやすい
  - 障害発生の際の切り分けはハイパーバイザー型よりしやすい
  - 伝統的なミッションクリティカルなシステムなそでは根強い人気がある

- コンテナー型
  - Docker
  - ゲストOSがホストOSのカーネル機能を共用することで軽量化する
  - コンテナー内のゲストOSには必要裁定げ園のライブラリしか含まない
    - CPUやメモリへの負荷が小さく、高速な処理が実現できる
    - アプリケーションの起動がスムーズになり、リソース効率がよくなる
  - **仮想サーバーのパッケージを小さく軽量化できる**
  - コンテナー単位で別サーバーに移行できる

### Webサーバーの負荷の実測

- 負荷テストツールによるテスト
- CPUとメモリの利用状況のモニター
  - `dstat` コマンドでCPUとメモリなどの負荷表示

### 仮想サーバーの性能見積もり

- 性能見積もりの例
  - 机上計算による積み上げ
    - ユーザー要求をもとに必要なCPU性能などを積み上げて算出する
  - 事例やメーカーの推奨
    - 同種の事例やソフトウェアメーカーの推奨を参考にして判断する
  - ツールでの検証や実測に基づく見積もり
    - ツールで深谷利用状況を測定して実測値をもとに算出する
  - 性能見積もりでは、基準値をベースに算出するのが基本

### データ分析システムの構成例

- データやログの分析
  - アプリケーションのデータやシステムへのアクセスのログなどは、DBやOSのLogに蓄積される
  - 蓄積されたデータを全文検索アプリの `Elasticsearch` で解析して、その結果をビジュアル化してくれる `Kibana` で表示する
  - Web環境で大量のデータを分析して表示してくれるしくみ

---

## セキュリティと運用

### 脅威に応じたセキュリティ対策

- 不正アクセスへの対策
  - 情報システムで一般的に取られているセキュリティ上の脅威のメインは、不正アクセス
  - データの漏洩、ユーザーへのなりすまし、ビジネスへの実害の恐れ

|セキュリティ脅威|対策例|
|:---:|:---:|
|外部からの不正アクセス|ファイアウォール<br>緩衝地帯（DMZ）<br>サーバー間っ通信の暗号化|
|内部からの不正アクセス|ユーザー管理<br>アクセスログの確認<br>デバイス操作の監視|

- 悪意ある攻撃
  - 迷惑メールや怪しい添付メールの送信
  - 大量のデータ送信によるサーバーのダウンを狙う
  - なりすましなどの標的型攻撃
  - OSなどの脆弱性を突く攻撃

### セキュリティ対策の物理的な構造

- ファイアウォールと緩衝地帯
  - ファイアウォールと内部のネットワークの間に緩衝地帯（DMZ）が設けられている

- 機能分けされた防御の方法
  - 緩衝地帯のように階層構造に機能分けして防御することを**多層防御**

### 緩衝地帯での守り方

- セキュリティ専用のネットワーク
  - ファイアウォールと内部のネットワークの間にある緩衝地帯
  - 緩衝地帯は、セキュリティシステム専用のネットワーク
  - 入り口のところに、セキュリティ対策機能を持ったサーバーやネットワーク機器を設置する
  - セキュリティ機能専用のハードウェアを1つにまとめる方法　→　UTM（Unified Threat Management）

- 侵入を検知して防止するシステム
  - 侵入検知システム（IDS：Intrusion Detection System）
  - 侵入防止システム（IPS：Intrusion Prevention System）

### 緩衝地帯を抜けた先の守り

- IDS/IPSを抜けた通信への対応
  - DoS（Denial of Service）攻撃のような短時間にサーバーが処理できないような大量のアクセスなどは防ぐことができる
  - 悪意のあるデータなどが含まれていても、見た目は正常に見える通信は通過することができる
  - WAF（Web Application Firewall）
    - 通信内容を見て悪意のあるデータの有無を確認するしくみ

- ログの分析と結果を反映するシステムが最重要
  - 過去の不正や悪意のある通信のログの蓄積と分析が重要

### お客様を守るしくみ

- 企業システムの本人確認
  - 多要素認証（Multi-Factor Authentication：MFA）
    - ICカード、生体認証、業務用PC以外の端末なども利用した厳格化

- なりすましやパスワードの取得などへの対策
  - パスワードクラッキング
    - IDを取得した第三者が、プログラムでパスワードを次々と試して当てることで本人へのなりすましを図る対策としてCAPTCHA
    - **CAPTCHA（Completely Automated Public Turing Test To Tell Computers and Humans Apart）**
  - セッションハイジャック
    - SessionとCookieなどを何らかの方法で取得される脅威
    - 異なる端末やIPアドレスからのアクセスであれば直ちに遮断する

### 内部のセキュリティ対策

- 内部の不正アクセスへの対策
  - Webサービスやシステムを提供する側の内部からの不正アクセスへの対策があってはじめて機能する
  - アクセスと利用制限
    - 認証機能
      - ユーザー名、パスワード、証明書、生体含む多要素認証
    - 利用制限
      - 管理者、開発者、メンバーなどの権限を設定したロールを提供し、業務要件に基づいて割り当てる（ロールベースアクセス制御）
  - データ秘匿
    - 伝送データの暗号化
      - VPN、SSLなど
    - 保管データの暗号化
      - ストレージ書き込み時に暗号化するなど
    - 不正追跡・監視
      - 不審者による利用の追跡ならびに監視を行う

### 稼働後の管理

- 運用管理
  - 運用監視：Zabbix、Hinemosなど
  - 性能管理
  - 変更対応
  - 障害対応
  - 定型的、マニュアル化できている運用など

- システム保守
  - 性能管理
  - レベルアップ
  - 機能追加
  - バグ対応
  - 障害対応
  - 主に、非定型、マニュアル化ができていない運用など

### 障害に対応するしくみ

- 本番系と待機系
  - 障害が発生しても稼働し続けるシステム**フォルトトレランスシステム（Fault Tolerance System）**
  - サーバーを本番系（アクティブ）、待機系（スタンバイ）にわける
    - 動いている機器と何かあったときのために待機している機器を用意する**冗長化**
    - 複数の機器で負荷を分散させる考え方

- クラスタリングの概要
  - **クラスタリング**
    - ユーザーから本番系・待機系が1つのシステムとして見えるようにすること
  - ホットスタンバイ
    - 本番系と待機系を準備してシステムの信頼性を向上させる方法
    - 本番系のデータを常時待機系にコピーして、障害発生時にすぐに切り替わる
  - コールドスタンバイ
    - 本番系と待機系を準備する
    - 本番系に障害が発生してから待機系を起動させるため、交代に時間がかかる
  - 自動フェイルオーバー（Failover）
    - 自動で再起動して待機系に切り替えるしくみ
